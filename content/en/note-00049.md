---
title: "Debian Workstation (usability) (v2023-10)"
date: 2023-10-07
categories:
  - desktop
  - english
tags:
  - linux
slug: debian-usability-2023a
---

## Workstation usability

The [older deprecated guide]({{< ref note-00038.md>}}) was used as the base.

Considering GNOME post-44 is going through major changes, I chose to use GNOME
43 in Debian 12 `bookworm` stable release for my workstation as of 2023-10-07.

I am trying to keep my workstation as clean `bookworm` installation as
possible.

This is non-hardware specific notes and tips. For the hardware specific notes
and tips, see also:

* [Thinkpad T14 Gen 1]({{<ref "note-00010.md" >}}) -- `hostname=goofy`
* [Sony Vaio SVT1313]({{<ref "note-00036.md" >}}) -- `hostname=casper`

## Bare metal initial system installation

### Initial installation by `debian-installer`

The initial installation by the `debian-installer` should skip "Desktop
environment (`task-desktop`)" task and select "SSH server (`task-ssh-server`)"
to make it light, GUI-less, and SSH-ready.

This process installs (mostly) packages with `Priority:` values in `required`,
`important` and `standard`.

For the rootfs for `/`, I use a partition formatted as btrfs.  The installer
automatically use subvolume `@rootfs` within its partition for the rootfs.
To make this system bootable with GRUB:

* For MBR system, you must create another partition set to be mounted at `/boot` and formatted as ext4fs.
* For UEFI system, you need no special action.  (You have a shared partition for "EFI system partition" automatically mounted at `/boot/efi` and formatted as FAT32.)

I leave the domain name as blank. All hosts on the same local subnet can be
accessed by adding `.local` at the end of each host name thanks to Avahi
(`avahi-autoipd` package).

### Initial manual setup (minimal CLI commands)

If your system boot into the GUI console for any reason, use "`CTRL-ALT-F?`"
(`?` can be 1-6) to access Linux virtual terminal login prompt. Otherwise, you
are already at login prompt on Linux virtual terminal.

Login to the root account and execute:

```
# apt-get update
# apt-get install aptitude sudo vim mc wget nano-`
```

NOTE: If you didn't set password for `root` during system installation with `debian-installer` in the expert mode, `sudo` is configured for you and you need to use it.

<!--

### Initial setup (automatic)

Running `initial-setup` script found at my repository should set up most of followings.

* https://github.com/osamuaoki/osamu-utils/blob/main/halexec/initial-setup

NOTE: See [Personal DEB package repository]({{< ref "note-00033.md" >}}) for how personal repo
is created and used.

-->

### Initial manual setup (SUDO)

For the passwordless `sudo` operation, configure `sudo` from root by adding `/etc/sudoers.d/passwordless` as:

```
# No passowrd required for the user in sudo group
# please note the last match wins configuration
%sudo ALL = (ALL:ALL) NOPASSWD: ALL
# No password for 8 hours
#Defaults timestamp_timeout = 480
#Defaults timestamp_type = global
```
NOTE: Please note that the last matching configuration is the active one for `sudo`.

### Tidy-up package installation status for aptitude.

I use `aptitude` as the primary package maintenance tool and identify
intentionally installed packages as a scrollable list by typing in
`~i!~M~poptional` in the `l` prompt of `aptitude`.

Since `debian-installer` installed packages doesn't set the auto install flag
(`M`), I usually tidy-up them up before installing GUI packages by setting
missing `M` flags to groups of files:

* packages under `libs` section
* packages under `Depends` and `Recommends` for:
  * `apt`
  * `dpkg`
  * `aptitude`
  * `debconf`
  * `task-desktop` etc. (if installed)

You can print list of intentionally installed packages as a plain text with:

```
$ aptitude search '~i!~M~poptional'
```

(This intensionally ignores some outdated packages with priority=extra packages.)

### Initial manual setup (SSH)

For paswordless `ssh` operation to the new system, configure ssh server as follows from the primary user:

* Copy ssh public keys of the main machine into new machine's `~/.ssh/authorized_keys` to allow access to the new machine from the main machine.
* Run `ssh-keygen` to generate ssh keys for the new machine
* Copy ssh public keys of the new machine into the main machine's `~/.ssh/authorized_keys` to allow access from the new machine to the main machine. (optional)
* Disable password-based login via `sudo vi /etc/ssh/sshd_config` to set `PasswordAuthentication no` for all machines after setting passwordless SSH logins.


### Initial manual setup (GNOME)

Install `task-desktop` package which pulls in `task-gnome-desktop` package to set up a decent GNOME GUI workstation with `aptitude`.

### Wallpaper for GRUB

Place your JPEG wallpaper graphics (JPEG) in `/boot/grub/` and update GRUB
configuration using  one of the followings:
* `sudo update-grub`
* `sudo dpkg-reconfigure grub-efi-amd64` # UEFI system
* `sudo dpkg-reconfigure grub-pc` # MBR system

### OS probing for GRUB

Somehow, the `GRUB_DISABLE_OS_PROBE` setting in `/etc/default/grub` seems to be
__unset__ during some automatic package reconfiguration steps involving
`grub-efi-amd64` and `grub-pc`.

Running `dpkg-reconfigure` interactively on them with `-plow` option and
answering explicitly as "Yes" to the question "Run os-prober automatically to
detect and boot other OSes?" will set `GRUB_DISABLE_OS_PROBE=false` and enable
OS detection.  This manual step is required after kernel updates etc., to work
around the __unset__ problem.

`sudo update-grub` doesn't do unset as above but requires explicit setting of
`GRUB_DISABLE_OS_PROBE=false` to do OS probing.

### Multi-boot with GRUB

For more robust multi-boot, I usually add following as `/etc/grub.d/40_fixed_linux`:
<!--

This is kept here but I don't know what it means ...

(The first line should be `#!/bin/sh` without space. Intentional mistype to avoid missing line):

-->
```sh
#!/bin/sh
exec tail -n +3 $0
# This file provides an easy way to add custom menu entries.  Simply type the
# menu entries you want to add after this comment.  Be careful not to change
# the 'exec tail' line above.
menuentry 'Debian GNU/Linux --- main SSD' --class debian --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-fixed-fe3e1db5-6454-46d6-a14c-071208ebe4b1' {
        load_video
        insmod gzio
        if [ x$grub_platform = xxen ]; then insmod xzio; insmod lzopio; fi
        insmod part_gpt
        insmod btrfs
        search --no-floppy --fs-uuid --set=root fe3e1db5-6454-46d6-a14c-071208ebe4b1
        echo    'Loading Linux from /dev/nvme0n1p5 ...'
        linux   /@rootfs/vmlinuz root=UUID=fe3e1db5-6454-46d6-a14c-071208ebe4b1 ro rootflags=subvol=@rootfs  quiet
        echo    'Loading initial ramdisk from /dev/nvme0n1p5 ...'
        initrd  /@rootfs/initrd.img
}
menuentry 'Debian GNU/Linux --- sub SSD' --class debian --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-fixed-51f9cd11-30b3-4d99-b2ed-fe411fa22ee6' {
        load_video
        insmod gzio
        if [ x$grub_platform = xxen ]; then insmod xzio; insmod lzopio; fi
        insmod part_gpt
        insmod btrfs
        search --no-floppy --fs-uuid --set=root 51f9cd11-30b3-4d99-b2ed-fe411fa22ee6
        echo    'Loading Linux from /dev/nvme1n1p1 ...'
        linux   /@rootfs/vmlinuz root=UUID=51f9cd11-30b3-4d99-b2ed-fe411fa22ee6 ro rootflags=subvol=@rootfs  quiet
        echo    'Loading initial ramdisk from /dev/nvme1n1p1 ...'
        initrd  /@rootfs/initrd.img
}
```

If you have multiple Debian system installed, you should make a backup copy
of `/boot/efi/EFI/debian/grub.cfg` to protect it gets overridden by installing
the second Debian system.

See https://wiki.debian.org/Btrfs%20migration .

## GNOME desktop customization

The `gnome-tweak` package installed as a dependency of `gnome` package helps to
tweak the system via GUI application `Tweak`.

The GNOME extension packages may not be robust for the update of GNOME.  So the
extensive use of them should be limitted to system tracking the `stable`
release.  They are available from [GNOME Extension web
site](https://extensions.gnome.org/local/) using browser with [GNOME Shell
integration](https://chrome.google.com/webstore/detail/gnome-shell-integration/gphhapmejobijbbhgpjhcjognlahblep)
enabled.  They can be configured via GUI application `Extensions`.

### Terminal customization

* Disable "F10"
* Use `MONO 14` or equivalent (HACK [NERD FONT](https://www.nerdfonts.com/font-downloads) MONO)
  * Install `*.ttf` files into `~/.fonts/` for a single user or `/usr/local/share/fonts/` for system wide installation.
* Add "080x24", "080x43", "127x43"
* Set shell as login shell if you want anything other than Bash.

### Right mouse click with single button

For Mac or some Sony Vaio with single tap pad button, the following allows
proper secondary-click (or even middle-click).

* `Tweaks`
* -> "Keyboard and Mouse" tab
* -> "Mouse Click Emulation" section
  * -> Check on "Area"

### Wallpaper for GNOME

You can set wallpaper graphics from:

* Desktop: `Settings` -> `Background`

* Desktop: `Tweaks` -> `Appearance` -> `Background`
* Lock Screen: `Tweaks` -> `Appearance` -> `Lock Screen`
* GDM3: --- Not so easy (leave this as is)

### Keyboard customization (GNOME Tweaks -- CapsLock)

For Vim user, mapping CapsLock to Esc as follows may be interesting:

* `Tweaks`
* Click `Keyboard & Mouse` tab
* Click `Keyboard` / `Overview Shortcut` / `Additional Layout Options` button
* Click to expand `Caps Lock behavior`
* Enable `Make Caps Lock as additional Esc`.

### Keyboard shortcut customization (GNOME Settings -- launcher)

* `SUPER-C`: launch calculator
* `SUPER-E`: launch email client
* `SUPER-B`: launch web browser

### Keyboard shortcut customization (GNOME Settings -- custom shortcut)

* `SUPER-\`: Open terminal

```
Name     Terminal
Command  gnome-terminal
Shortcut SUPER-\
```
(`SUPER-\` is easier to type than `SUPER-T`.)

### Keyboard shortcut customization (GNOME Extension -- IM)

- Installed my GNOME extension: [Quick switching of input method and touchpad](https://github.com/osamuaoki/inputmethod-shortcuts) -- source
  - [GNOME extension: Input method and touchpad shortcuts](https://extensions.gnome.org/extension/6066/shortcuts-to-activate-input-methods/)
- Log out and log in to GNOME
- Enabled shortcuts from GNOME shell extension preference menu as:
  - `CTRL-SUPER`: English (US)
  - `SHIFT-SUPER`: Mozc
  - `SUPER-CTRL`: English (international)

For other extensions I use, see [GNOME extensions for better UX]({{<ref "note-00045.md">}}).

### Keyboard shortcut customization (Internal IM configuration)

For Japanese input with US keyboard, set IM (anthy etc.) configuration as:
* SHIFT-SPACE: 全角かな入力 (hiragana mode) 変換キー equivalent
* CTRL-SPACE: 英数半角入力 (latin mode) 無変換キー equivalent

See my old [Japanese input on US-keyboard (in Japanese)](/jp/2019/03/23/gnome-uskb-im-select/) and its [Google translation](https://osamuaoki-github-io.translate.goog/jp/2019/03/23/gnome-uskb-im-select/?_x_tr_sl=ja&_x_tr_tl=en&_x_tr_hl=en&_x_tr_pto=wapp#%E6%97%A5%E6%9C%AC%E8%AA%9E%E3%82%AD%E3%83%BC%E3%83%9C%E3%83%BC%E3%83%89%E3%81%AEim%E5%81%B4%E3%81%AE%E8%A8%AD%E5%AE%9A%E6%96%B9%E6%B3%95).

### Non-usable Keyboard shortcut key combos with super

- Any use of `SUPER`+`modifier`+`SPACE` or `SUPER`-`SPACE` breaks normal `SUPER`-`SPACE` for rotating input method and bad idea
- `SUPER`-`P` seems to be unresponsive
- `SUPER`-`O` seems to be unresponsive

## Application customization

### Shell setups

* `~/bin` scripts: https://github.com/osamuaoki/osamu-utils (`hal`, `sendmail-p.d.o`)
  * Key dot files in `~/` and `~/.config` are stored in this [osamu-utils repo under dot/](https://github.com/osamuaoki/osamu-utils/tree/main/dot).
  * These stored dot-files are updated by `hal conf update`
  * These stored dot-files are restored to active use by `hal conf install`

### Editor setups
* Main `vi` editor: `nvim` with `~/.config/nvim`
  * NeoVim 0.10.  See [Building Neovim]({{< ref "note-00039" >}}).
  * Configuration by [forked LazyVim starter](https://github.com/osamuaoki/starter) in `~.config/nvim`.  See [Re-learning Vim (7)]({{< ref "note-00040" >}}).
* Backup `vi` editor: `vim` with `~/.vim`
  * Configuration by https://github.com/osamuaoki/dot-vim in `~/.vim`.
  * Custom package management of Vim 8 with native `packadd!`.
  * See [Re-learning Vim (2)]({{< ref "note-00007" >}}).

Frequent commands to use:

* `bash`: CLI command prompt
* `mc`: file manager for shell
* `fzf`: fuzzy finder for shell and vim.
* `rg`: recursive code search
* `bu`: local `~/bin/` script to backup data to USB drive using `bss` as its backend.  See [Backup and snapshot]({{< ref "note-00028.md" >}}).

### Personal packages

See [Personal DEB package repository]({{<ref "note-00033.md">}}) for the method to publish personal DEB packages.

You need to addd [configuration file for personal DEB package repository]({{< ref "note-00033" >}}#setting-up-secure-apt-cliant) to use them.

Here are some of my personal packages to help my command line.  The source of these are published to
my github repo and binary packages are published to my github web page.

* bss: Btrfs Subvolume Snapshot Utility
  * https://github.com/osamuaoki/bss
  * This helps me with easy backup and snapshot using btrfs.
* unzip: patched unzip (`-O` and `-I` options to support encoding of filenames)
  * https://github.com/osamuaoki/unzip
  * provides unzip-i18n
  * This replaces Debian unzip program which lacks `-I` and `-O` options to
    offer functionality available under other distribution.
    * Use `unzip -Osjis filename.zip` to unzip Japanese zip files.
* osamu-task: Osamu's Task Packages  -- WIP updating
  * https://github.com/osamuaoki/osamu-task
  * 00-cli, 00-dev, 00-doc, 00-gui, 00-jpn, 00-min, 00-notex, 00-typ
  * This helps me with installing packages as a group.

### Web browser

Although [Chromium](https://tracker.debian.org/pkg/chromium) exists in the
official Debian repository, it lacks [account synchronization capability with
other devices since
2021](https://blog.chromium.org/2021/01/limiting-private-api-availability-in.html).
Although there are [some workarounds tips posted on
web](https://stackoverflow.com/questions/67459316/enabling-chromium-to-sync-with-google-account),
installing [Chrome](https://www.google.com/chrome/) can solve this situation
for sure.

The best solution seems to be adding APT repository by adding
[/etc/apt/sources.d/google.sources](https://github.com/osamuaoki/osamu-utils/blob/main/etc/apt/sources.list.d/google.sources)
in DEB822-STYLE FORMAT and select the `google-chrome-stable` package.

### Shotwell

Shotwell 0.30 in Debian/bookworm doesn't support HEIF image files.

I installed Shotwell 0.32.1 or newer [flatpack package from Gnome upstream](https://wiki.gnome.org/Apps/Shotwell/BuildingAndInstalling).

See [HEIF image files]({{< ref "note-00041" >}}) on more HEFI tips.

### LibreOffice

Debian 12 `bookworm` (stable release) offers the LibreOffice 7.4.7.  I think it
is in good shape.

If any issues arise, I may switch to upstream flatpack package offering LibreOffice 7.6. (2023-10-08)

### Mail client

For the GUI access to the remotely hosted IMAP4 mail services, use GNOME Online
accounts and Evolution.  This approach works for Gmail etc. and compatible with
using other devices such as smart phones.  Evolution can also be configured to
read locally delivered mails to mbox too.  (send+receive).

For the command line such as `reportbug` and daemon programs such as `cron` to
send mails to external hosts and local accounts, use of `exim4` as the locally
installed MTA is good idea.  With "sudo dpkg-reconfigure exim4-config", Select
"mail sent by smarthost; received via SMTP or fetchmail".  Everything else can
be default.

To use Gmail for smarthost, set up "Mail Server configuration" as
"smtp.gmail.com::587".  It is irrelevant for us to worry "Hide local mail name
..." since the smarthost service rewrites it anyway.  Edit
`/etc/exim4/passwd.client` as:
`smtp.gmail.com:foo.bar@gmail.com:application_password` (You need to create
`application_password` in advance.)

Whenever I wish to send out mails with "@debian.org" address, I use
ssh+sendmail (created shell script `~/bin/sendmail-p.d.o`) to access a Debian
host. (This trick may be usable for any hosts such as salsa.debian.org etc.)

I have mail configuration for:

* Evolution
* `devscripts` (add "`BTS_SENDMAIL_COMMAND='/home/osamu/bin/sendmail-p.d.o'`" to `~/.devscripts`)
* `reportbug` (add "`mta /home/osamu/bin/sendmail-p.d.o`" to `~/.reportbugrc`)

I usually don't bother with `fetchmail` these days.

## Miscellaneous tips

## Setting group membership

Don't forget to setup group membership for the primary user (UID=1000).  Notable groups are:
  * `adm`
  * `src`
  * `staff`
  * `sudo`  --  by adding this, you enable sudo with password
  * `lxd` -- for LXD
  * `backup` -- for backup operation
  * `www-data` -- for web server

You need to re-login to enable them.

### Re-install and UID/GID issues

UID and GID used by some applications are not fixed.  So, if you reinstall the
exact same packages in a different order, you end up assigning UID and GID for
the application.

UID in range between 101-999 such as ones for `avahi`, `saned`, `colord`,
`_ssh`, ...  are the most susceptible on this issue.

`apt-cacher-ng` needs special attention.

### EFI-based firmware updates

Install `gnome-firmware` package and invoke GUI to update firmware on devices
supported by `fwupd` using [Linux Vendor Firmware Service](https://fwupd.org/).

Many firmware data can be updated using `gnome-firmware`.

#### Workaround for some firmware

Some firmware devices may experience some problem to be updated by
`gnome-firmware`.

Most notable one on my system was "Lenovo System Firmware".  (I don't know if
this was version dependent or not.) I used vendor's BIOS update offered as
bootable CD and made USB key containing it image data:

 * https://pcsupport.lenovo.com/us/en/products/laptops-and-netbooks/thinkpad-t-series-laptops/thinkpad-t14-type-20ud-20ue/downloads/driver-list/component?name=BIOS%2FUEFI

If the BIOS options `Security > Secure Boot` is enabled, it may restrict booting
up from the BIOS Update bootable CD image, you may need to disabled the Secure Boot option to use it.

If Windows 10 or 11 is installed, you may need to reenable Secure Boot after
this operation.

<!-- vim: set sw=2 sts=2 ai si et tw=79 ft=markdown: -->
