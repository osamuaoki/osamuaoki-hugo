---
title: "Re-learning Vim (2)"
date: 2019-09-24
categories:
  - desktop
  - english
tags:
  - vim
slug: vim-learn-2
---

Let's review a few interesting plugins.

Please note that I manage plugins via Vim 8's native plugin management
framework.

## Vim general settings (packages)

As of 2021-08-27, I mostly use the latest version from github:

* ale (on demand linter)
* securemodelines
* vim-spell-under (I wrote)
* vim-better-whitespace
* vim-indent-guides
* gnupg (provided by vim-scripts)
* matchit (provided by vim)
* fzf and fzf.vim with rg (access functionalities with `<leader>`)
* gitgutter (on demand)
* vim-python-matchit (I use locally patched 0.5)
* vim-airline
* vim-airline-themes

Please note actual basic configuration settings are in `~/.vim/vimrc`.  This
file includes the Vim 8 native package management.  The whole `~/.vim/`
contents are at [dot-vim](https://github.com/osamuaoki/dot-vim/).

I use linters with very quiet configuration defined in my dotfiles.  The backup
copies of these dotfiles are at
[osamu-utils](https://github.com/osamuaoki/osamu-utils).  No sensitive info's
are in these.  That's backed up locally.

I now set up those IDE-like heavy features as on-demand and low profilei from
user's view. (You can further disable packages by comment out corresponding
`packadd!` line with leading `"`.)

Also, cursor remembers its position.

## Vim general settings (keyboard bindings)

Thought on configuration and keyboard bindings are:

* Use external packages as much with least exposure to them.
* For hard to reach Esc-key issue, use CapsLock for it via GNOME Tweak setting.
* Less keyboard customization is better.
* Avoid redefining keys with similar **improved** variants (instead, define new ones)
* Some shell-like control key bindings in INSERT and COMMAND modes.
* Give easy access to FZF.VIM provided functions with `<leader>`

For now, I set them up as:
  * `Q`: Paste MACRO
  * `<C-t>`: swap chars[-2],[-1]
  * `<leader><leader>`: Highlight search word under the cursor in NORMAL, or exact selected word in VISUAL to z-register
      * `<C-L>` to clear highlight
      * `<leader>s` to create substitute all template
  * `<leader><CR>`: TERMINAL-JOB start
      * `<Esc><Esc>` or `<Esc>`: get out to TERMINAL-NORMAL
      * `i`: get back to TERMINAL-JOB
  * `<leader>a`: Toggle ALE (ALE)
    * Set up linters
  * `<leader>d`: Strip tailing spaces (vim-better-whitespace)
  * `<leader>w`: Close all
  * `<leader>z`: Un-fold all
  * `<leader>=`: Vim indent formatter
  * `<leader>gg`: Toggle GitGutter (GitGutter)
    * `<leader>hp`: hunk preview (GitGutter) -- default
    * `<leader>hs`: hunk stage (GitGutter) -- default
    * `<leader>hu`: hunk undo (GitGutter) -- default
  * FZF commands
    * `<leader>b`: Buffers selection (FZF.VIM)
    * `<leader>c`: Color selection (FZF.VIM)
    * `<leader>f`: Files selection (FZF.VIM)
    * `<leader>gl`: GFiles selection (FZF.VIM) -- `git ls-files`
    * `<leader>gs`: GFiles? selection (FZF.VIM) -- `git status`
    * `<leader>m`: Maps listing with selection (FZF.VIM)
    * `<leader>r`: Rg search selection (FZF.VIM)
    * `<leader>v`: History selection (FZF.VIM)
    * `<leader>x`: Command selection (FZF.VIM)
    * `<leader>/`: Text search history selection (FZF.VIM)
    * `<leader>:`: Ex-command search selection (FZF.VIM)
    * `<leader>t`: Tags search selection (FZF.VIM)
    * `<leader>...`: many others (FZF.VIM)

For selecting TAB opened from FZF with CTRL-T.
  * `<leader>1`: Tab 1
  * `<leader>2`: Tab 2
  * ...

Most of FZF commands `<leader>`-commands are not used much.  So I may change.

I set the font setting of GNOME terminal and GVim to
[Hack](https://tracker.debian.org/pkg/fonts-hack) 14 point. Not all
non-standard `powerline` fonts are included.  So skip them in `airline` in
`override.vim`.  This font has easy-to-identify `0oO` and `1lI` fonts and some
cute non-standard glyphs used for producing cute bar with airline.

## Local entry point: `~/.vim/vimrc` and `~/.vim/gvimrc`

Let's list highlight of configuration.  Local configuration for each plugins
are also included in this
[~/.vim/vimrc](https://github.com/osamuaoki/dot-vim/blob/master/vimrc) file.

### Quote and comment and line continuation in VimScript

* Quoted string in VimScript is single quote.
* Comment lines start with double quote
* Line continuation is reverse slash prepended to the following line.  It seems
  leading blank characters are allowed.

### Map `<F2>` to toggle PASTE MODE in INSERT MODE

Adjust PASTE MODE by `F2`-key.

```
set nopaste
set pastetoggle=<f2>
```

### Map `Q` to `@q` in NORMAL MODE

Record and apply keyboard MACRO just with `q`-key. ("qq" to start recording
MACRO, "qq" to quit recording MACRO, "Q" to apply MACRO)
```
nnoremap Q @q
xnoremap Q :norm @q<cr>
```

### Map `<leader><leader>` in NORMAL MODE

This is to automatically select word below cursor.  Very useful for search and
replace operation. `*` and `#`.

### Map `<Esc><Esc>` and `<Esc>` to `<C-\><c-n>` in TERMINAL-JOB MODE

Since TERMINAL-JOB MODE feels like INSERT/REPLACE MODE, I didn't like vim style
`<C-w>N` nor odd neovim style `<C-\><c-n>` to get out.  I accidentally typed
`<C-w>` in INSERT MODE to lose data.  Now I can always bang on `<Esc><Esc>`
everywhere first if I want to move around windows.

Remapping `<Esc><Esc>` in addition to `<Esc>` avoids causing interference with the
terminal escape code (ISO color etc.) and mapping/keyboard delays.

FZF.VIM issues are handled.

### `gvim` font setting

Setting to '`Hack 14`' required to use escaped space in the
[~/.vim/gvimrc](https://github.com/osamuaoki/dot-vim/blob/master/gvimrc) file.


## External packages

### `dense-analysis/ale`

**This is used a lot**

This is a very nice syntax checker front-end.
.
See [Development system (3)]({{< ref "note-00025.md">}}) to understand how to
set up backend linters.  Setting these to be not-so-noisy are important part of
their configuration.  I also backuped them to my dotfiles:
[osamu-utils](https://github.com/osamuaoki/osamu-utils).

It is important to use static checker for interpreter languges since they
usually don't complain even if typo causes unused/non-assigned variables.

I use this with:

* shell: `shellcheck`
* python3: `pylint` and `flake8` (These needs to be set to be quiet to avoid
  excessive noise.)  See
  https://github.com/osamuaoki/osamu-utils/tree/main/dot/.config for backed up
  settings.

LSP hasn't been used.

* https://github.com/dense-analysis/ale (FAQ)
* https://www.vimfromscratch.com/articles/vim-and-language-server-protocol/
* https://github.com/rhysd/vim-lsp-ale
* https://github.com/prabirshrestha/vim-lsp

### `ciaranm/securemodelines`

Features like "modeline" is very convenient but it may become source of
security concern.  This plugin disables Vim's native capability for "modeline"
but still enables very limited commands to be parsed.

Since this works even under "`:set nomodeline`" default start scheme, I am
using this all the time.

### `osamuaoki/vim-spell-under`

When syntax highlist and spell checker are activated together, text becomes
difficult to read in some cases in terminal.  This forces spell checker to use
underline.

### `ntpeters/vim-better-whitespace`

This is a new improved version of `bronson/vim-trailing-whitespace` .  This
takes care all weird UTF-8 spaces too.

* Mark all types of spaces in wrong position on display.
* Strip tailing spaces upon hitting "`<SPACE>s`" only.

My configuration marks all problematic spaces but only remove problematic
dangling spaces upon explicit user request.  (So the annoyance noticed by #vim
Recommendations is addressed.)

### `nathanaelkane/vim-indent-guides`

This is a plugin for visually displaying indent levels in Vim.

Unlike using vim native approach of "`:set list`" with "`:set listchars=...`"
to visualize TAB and tailing spaces, `vim-better-whitespace` and
`vim-indent-guides` doesn't cause problem when selecting screen area with
mouse-drags.

### `gnupg` (vim-scripts)

This let you use gnupg.

### `matchit` (vim internal and optional)

This let you move between matching `{` and `}` and similar pairs.

### `osamuaoki/vim-python-matchit`

This let you move between matching `if`/`try`-block sections and
`for`/`while`-block sections in python.  Since `for`/`while` can have `else` in
python, I patched upstream 0.5 to cover this case.

### `junegunn/fzf` and `junegunn/fzf.vim`

I installed this to manage most of my `<leader>` interface commands for files,
buffers, text search, ... .  Nice interactive window menus.

As for grepping the source, `ripgrep`(`rg`) and `ugrep`(`ug`) seems to be SMP
aware and 10x faster than `ag`.  Since `rg` is Git aware (`.gitignore`), this
was my choice.  I installed the Debian `ripgrep` package.

Since this use terminal mode, `<Esc>` handling needs to be adjusted to avoid
crashing.

### `airblade/vim-gitgutter`

It is installed but not activated on demand and default off.

### `romainl/vim-qlist`

**This has not been used much but interesting.  (commented out now)**

Native behavior of `[I`, `]I`, `[D`, and `]D` to search the keyword and the
macro definition is a bit half baked.  It should be much nicer if it allows to
jump to pertinent positions as in the QuickFix list.

This script replaces these NORMAL MODE commands with more desirable behavior
ones of the QuickFix list.

### `jceb/vim-orgmode`

**This has not been used much but interesting.  (commented out now)**

### `airblade/vim-gitgutter`

**This is not used but interesting. (not used recently under this configuration)**

Checks diff from the repository contents asynchronously without blocking editor
response and mark changed lines.

### `vim-airline/vim-airline` and `vim-airline/vim-airline-themes`

I understand this is only visual sugar candy and not much functionality
improvement as Gurus told me.

But it was irresistible ... Sigh ... Forgive me for my weakness.  I try to use
this with minimal complications, though.

Other similar packages such as `rbong/vim-crystalline` and
`itchyny/lightline.vim` require you to write custom script from scratch and if
such scripts are added, their claimed advantages may not be true any more.
On the other side, the popular `vim-airline` seems to have addressed all the
interference issues already and works as out-of-box as long as the latest
version is obtained from github.  (Well.. sort of. I had to adjust local font
glyph availability issues.)

If I need really light statusline, I use bare static status line string defined
in `~/.vim/vimrc`).  If vim-airline is active, this setting is overridden.


<!-- vim: set sw=2 sts=2 ai si et tw=79 ft=markdown: -->
