---
title: "GTK GUI with PyGObject (9)"
date: 2021-07-22
categories:
  - coding
  - english
tags:
  - python
  - gtk
slug: pygi-9
---

## Client-side decoration with GtkHeaderbar using Glade

Let's consider to add client-side decorated
[GtkHeaderBar](https://lazka.github.io/pgi-docs/Gtk-3.0/classes/HeaderBar.html)
and to put primary menu with
[GtkPopover](https://lazka.github.io/pgi-docs/Gtk-3.0/classes/Popover.html).

This isn't intuitive but I think I figured out.  So I made some postings.
* [Can't add GtkHeaderBar to "Client side window decoration" area](https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=991468)
* [Can't add GtkHeaderBar to window with existing widgets / containers](https://gitlab.gnome.org/GNOME/glade/-/issues/499)

Let's use Glade to design GUI.  The GtkHeadBar can be anywhere but placing at the end
makes editing with the text editor easy later.

![Glade initial GUI design](/img/head-start.png)

Activating the "Client-side window decorations" checkbox creates odd
non-editable area inside the window.  Trying to put a widget there causes the
error message as follows:

![Glade not woring as expected](/img/head-csd.png)

This is odd but seems intentional design of Glade.

Please look into the UI XML file.  There is a odd XML tag `<placeholder/>` which has been added inside of the newly added `<child type="titlebar">...</child>`-tag pair.  This meaning of `type="titlebar"` is explained in [GtkWindow](https://lazka.github.io/pgi-docs/#Gtk-3.0/classes/Window.html#class-details) as "The __Gtk.Window__ implementation of the __Gtk.Buildable__ interface supports setting a child as the titlebar by specifying “titlebar” as the “type” attribute of a `<child>` element.".

```
<?xml version="1.0" encoding="UTF-8"?>
<!-- Generated with glade 3.38.2 -->
<interface>
  ...
  <template class="window" parent="GtkWindow">
    <property name="can-focus">False</property>
    <child>
      ...
        <child>
          <object class="GtkHeaderBar" id="header">
            ... (snipped)
          </object>
          <packing>
            <property name="expand">False</property>
            <property name="fill">True</property>
            <property name="position">4</property>
          </packing>
        </child>
      </object>
    </child>
    <child type="titlebar">
      <placeholder/>
    </child>
  </template>
</interface>
```

This `<placeholder/>` is sloppy but practical Glade support of "Client-side window decorations".

Since Glade expects us to manually touch-up this XML file, let's do it.

First move `<child><object class="GtkHeaderBar" id="header">...</child>`
to just after `<placeholder/>` and
remove `<placeholder/>`.

Then remove now redundant `<child>` and `</child>` tags from newly moved
section.  Indentation is non-significant.  Glade also functions as a pretty
printing tool.

```
<?xml version="1.0" encoding="UTF-8"?>
<!-- Generated with glade 3.38.2 -->
<interface>
  ...
  <template class="window" parent="GtkWindow">
    <property name="can-focus">False</property>
    <child>
      ...
    <child type="titlebar">
      <object class="GtkHeaderBar" id="header">
        ... (snipped)
      </object>
      <packing>
        <property name="expand">False</property>
        <property name="fill">True</property>
        <property name="position">4</property>
      </packing>
    </child>
  </template>
</interface>
```

Let's open Glade to see what happened.

![Glade with CSD titlebar](/img/head-titlebar.png)

Look at widget for GtkHeaderBar.  It now has __(titlebar child)__ added and placed at the top of the window screen.


### How to create GUI program

Now we are ready to use this touched-up Glade origin GUI design XML file from `head_win.py`.

XXX FIXME XXX

The following needs to be finished.

{{< snippet "examples/glade/simple3.py" >}}

Since we use the same name for the assigned variable and the ID in XML,
`Gtk.Template.Child()` takes no argument now.

Running this with `python3 simple3.py` will start the GUI as:

![Run simple3](/img/simple3-py.png)

Please play with this GUI while looking at your terminal outputs.

## How touch-upped Glade generated XML looks

For the record, the full XML file `head_win.ui` is here.

{{< snippet "examples/glade/head_win.ui" >}}

<!-- vim: set sw=2 sts=2 ai si et tw=79 ft=markdown: -->
