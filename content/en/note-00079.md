---
title:  Rescue media(2)
date: 2025-08-22T00:00:00+00:00
categories:
  - Debian
  - english
tags:
  - rescue
slug: rescue-02
---

This is updated memo of [Rescue media(1)]({{< ref "../jp/note-00025.md" >}})  (in Japanese).

## Rescue media

There are many iso images which are useful for system administration and rescue
tasks available on the web.  Here are some of the notable ones:

* [GParted live](https://gparted.org/livecd.php)
  * GOOD: active
  * GOOD: Debian based system rescue media.
  * GOOD: GUI partition manager
  * BAD: Currently, Debian Lacks GUI LVM manager like [blivet-gui](https://github.com/storaged-project/blivet-gui)
    * TODO: Follow [Create GParted live from scratch](https://gparted.org/create-gparted-live.php) to install [blivet-gui deb pakage](https://software.opensuse.org/download.html?project=home:vtrefny&package=blivet-gui)
* [debian-installer (netinst)](https://www.debian.org/distrib/netinst)
  * GOOD: active and stable
  * GOOD: This facilitates official Debian system install.
  * BAD: "rescue mode" needs to mount a functioning root filesystem and it can't
  be unmounted for filesystem operation (fsck...).
* [Debian live](https://www.debian.org/CD/live/index.en.html)
  * GOOD: active
  * GOOD: Debian based system rescue media.
* [Kali Linux Live image ](https://www.kali.org/get-kali/#kali-live)
  * GOOD: active
  * GOOD: Debian based system rescue media.
* [SYSTEM RESCUE HOMEPAGE](https://www.system-rescue.org/)
  * GOOD: active
  * FAIR: ARCHlinux based system rescue media
* [Super Grub2 Disk](https://www.supergrubdisk.org/super-grub2-disk/)/[Rescatux](https://www.supergrubdisk.org/rescatux/)
  * GOOD: last release 2024 for [Super Grub2 Disk](https://www.supergrubdisk.org/super-grub2-disk/) (the multi disk/iso boot loader, now support btrfs)
  * BAD: last released in 2021 for [Rescatux](https://www.supergrubdisk.org/rescatux/) (outdated linux iso image)
* [Ventoy](https://www.ventoy.net/en/index.html)
  * GOOD: active (the multi disk/iso boot loader w/o iso image)

## Ventoy + Gparted for rescue USB-key

Since modern USB-keys have huge storage space, I decided to use
[ventoy](https://www.ventoy.net/en/index.html) and put all interesting iso
images in it. This way, I only need to maintain one USB key.

For the moment, I will mostly use
[GParted live](https://gparted.org/livecd.php) iso image.

## Booting system with USB-key

* Sony Vaio SVT1313: power up system with a USB key inserted with "ASSIST" button.
* Thinkpad T14 Gen 1 (AMD): power up and press ENTER or F12

## Use case: Migrating from ext4 to Btrfs for home

Let's think about a system installed with `d-i` using its full disk install
option with LUKS encryption on MBR SSD.

* hostname=`casper`
* `/dev/sda1`: `/boot` (1GB)
* `/dev/sda2`: extended partition holding `/dev/sda5`
* `/dev/sda5`: holds LUKS (479GB)
* LUKS: holds LVM2 PV `/dev/mapper/sda5_crypt`
* PV `/dev/mapper/sda5_crypt`: used as a only member of VG `casper-vg`
* VG `casper-vg` found in `/dev/casper-vg` holds 3 LVs
  * `/dev/casper-vg/root` = `/dev/mapper/casper--vg-root` (ext4, 32GB)
  * `/dev/casper-vg/home` = `/dev/mapper/casper--vg-home` (ext4, 438GB)
  * `/dev/casper-vg/swap_1` = `/dev/mapper/casper--vg-swap_1` (swap, 8.5GB)

Please note `-` in VG name is repeated in name used under `/dev/mapper`.

Let's convert `/dev/casper-vg/home` to use btrfs instead of ext4.

* Boot from USB to use rescue boot shell
  * Decrypt LUKS partion (`/dev/sda5`)
    * `sudo cryptosetup luksOpen /dev/sda5 sda5_crypt`
    * Now you see `/dev/mapper/casper--vg-home`, `/dev/mapper/casper--vg-root` etc.
    * Mount `/dev/mapper/casper--vg-home` to `mnt/home`
    * Mount `/dev/mapper/casper--vg-root` to `/mnt/root`
  * Copy all data from `/mnt/home/username` to `/mnt/root/home/`.
  * Remove mounting of `casper--vg-home` iin `/etc/fstab` by adding `#` at the head of line..
* Boot normal SSD system
  * Install required program
    * `sudo apt install btrfs-progs`
  * Format forcebly the old `home` LV as btrfs
    * `sudo mkfs.btrfs -f /dev/mapper/casper--vg-home`
  * Check LV and VG names with `lvs` and `vgs`
  * Rename the old `home` LV to `btrfs` LV
    * `sudo lvrename casper-vg home btrfs`
  * Mount `/dev/mapper/casper--vg-btrfs` at `/mnt`
    * `sudo mount /dev/mapper/casper--vg-btrfs /mnt`
  * Create subvolume `@home` at `/mnt`
    * `sudo btrfs subvolume create @home /mnt`
  * Copy back data under `/home` to `/mnt/@home`.
  * Change mounting of home in `/etc/fstab` to use `@home`-subvolume for home.
    * Add `/dev/mapper/casper--vg-btrfs btrfs default,subvol=@home 0 2` in `/etc/fstab`
  * Reboot

NOTE: Use `pvs`, `vgs`, `lvs`,and `lvmdiskscan` commands to assess LVM
situation.  These are `lvm` subcommands but can be invoked as normal commands
without `lvm` prefix.

NOTE: `lvresize` can be invoked with `-r` option to perform FS resize along
with LV resizing.

<!--
vim: set sw=2 sts=2 ai si et tw=79 ft=markdown:
-->
