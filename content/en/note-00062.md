---
title:  python venv
date: 2024-02-02T00:00:00+00:00
categories:
  - coding
  - english
tags:
  - python
slug: python-venv
---

## Python virtual environment

I finally get to use python virtual environment using `venv` module to be
created under `~/.venv/`. (I wanted to upload a package to pypi.org)

```sh
 $ apt install python3-pip twine
 ...
 $ python3 -m venv ~/.venv
 $ source ~/.venv/bin/activate
(.venv) $ install --upgrade pip
 ...
(.venv) $ install --upgrade twine
 ...
(.venv) $ deactivate
```

System packages were current enough to cause printing
`Found existing installation: pip 23.0.1`,
etc. and no new packages were installed in `~/.venv`.

Anyway, I now know how to activate and deactivate python virtual environment.

## Setup keyring

We need to set up access to the keyring tool `keyring` (backend `secret-tool`):

* deb:`apt install python3-keyring`
* venv: `pip install --upgrade keyring`

## Setup Twine

We need to set up access to the upload tool `twine`:

* deb: `apt install twine`
* venv: `pip install --upgrade twine`

## Get API token to keyring

I got API tokens following their instructions:

* [test.pypi.org API token](https://test.pypi.org/help/#apitoken)
* [pypi.org API token](https://pypi.org/help/#apitoken)

I followed [Twine: Keyring Support](https://twine.readthedocs.io/en/stable/#keyring-support) to store API tokens into keyring.

For test pypi:
```sh
 $ keyring set https://test.pypi.org/legacy/ __token__
Password for '__token__' in 'https://test.pypi.org/legacy/': pypi-token-value
```
For real pypi:
```sh
 $ keyring set https://upload.pypi.org/legacy/ __token__
Password for '__token__' in 'https://upload.pypi.org/legacy/': pypi-token-value
```
## Failed test upload with `imediff`

I followed [Twine documentation](https://twine.readthedocs.io/) to build
package for `imefiff` and upload to test.pypi.org.

```sh
 $ cd path/to/imediff
 $ python3 -m build
...
 Successfully built imediff-2.8.tar.gz and imediff-2.8-py3-none-any.whl
 $ twine upload --verbose --repository testpypi dist/*
...
ERROR    HTTPError: 400 Bad Request from https://test.pypi.org/legacy/
         The description failed to render in the default format of reStructuredText. See https://test.pypi.org/help/#description-content-type for more information.
```

You may use `pyproject-build` for `python3 -m build` if deb is installed.

Since keyring is properly setup, this didn't ask password.

I suppose I am doing something wrong: [Linked site for content-type](https://test.pypi.org/help/#description-content-type).

I added `README.rst`.  No sucess.

## Test upload of known-good-package

TBD.

## References

* [pypi.org](https://pypi.org/) -- real site
  * [pip documentation](https://pip.pypa.io/en/stable/)
    * [Getting Started](https://pip.pypa.io/en/stable/getting-started/)
    * [Python Packaging User Guide](https://packaging.python.org/en/latest/)
      * [Packaging Python Projects](https://packaging.python.org/en/latest/tutorials/packaging-projects/)
      * [Uploading the distribution archives](https://packaging.python.org/en/latest/tutorials/packaging-projects/#uploading-the-distribution-archivesa)
* [test.pypi.org](https://test.pypi.org/) -- test site

<!--
vim: set sw=2 sts=2 ai si et tw=79 ft=markdown:
-->
