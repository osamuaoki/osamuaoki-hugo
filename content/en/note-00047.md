---
title: GNOME shell extension for input methods
date: 2023-06-19T00:00:00+00:00
categories:
  - desktop
  - english
tags:
  - gnome
slug: gnome-im-1
---

Since I didn't find GNOME shell extension to provide shortcuts to input method
activations, I decided to create one by following examples of existing
extensions without rigorous learning.

## Simple GNOME shell extension

One can create a skelton of a simple GNOME shell extension as:
```sh
$ gnome-shell-extension-tool --create-extension
```

This created a almost empty GNOME shell extension under
`~/.local/share/gnome-shell/extensions/`.

After "Log out" and "Log in" to my account, this GNOME shell extension can be
seen from "Extensions".  But this was too simple to do anything useful.

## How to get keybinding

In order to find keybinding definition examples, I looked around for simple
extensions.

### GNOME extension "Shortcuts"

GNOME extension [Shortcuts](https://gitlab.com/paddatrapper/shortcuts-gnome-extension)
looked like simple enough since all it does is toggling of display when `<Super>s` is pressed.

But there is no text like `super` in the source.  It looks like `imports.ui.main.overview` gets a call back to enable toggling of display.

```javascript
const Main = imports.ui.main;
...
  Main.overview._specialToggle = function (evt) {
    _toggleShortcuts();
  };
```

`gnome-shell` source has `js/ui/main.js` which calls `overview.init()` then `js/ui/overviw.js` which has `overview.init()` calling:

```
const Main = imports.ui.main;
...
Main.wm.addKeybinding(
    'toggle-overview',
    new Gio.Settings({ schema_id: WindowManager.SHELL_KEYBINDINGS_SCHEMA }),
    Meta.KeyBindingFlags.IGNORE_AUTOREPEAT,
    Shell.ActionMode.NORMAL | Shell.ActionMode.OVERVIEW,
    this.toggle.bind(this));
```

In `data/org.gnome.shell.gschema.xml.in` from `gnome-shell` source, I found:

```xml
<key name="toggle-overview" type="as">
│ <default>["&lt;Super&gt;s"]</default>
│ <summary>Keybinding to open the overview</summary>
│ <description>
│ │ Keybinding to open the Activities Overview.
│ </description>
</key>
```
So basically, this extension uses keybinding defined by `gnome-shell`.

The schema definition `<default>["&lt;Super&gt;s"]</default>` used in `data/org.gnome.shell.gschema.xml.in` is interesting.
Also, `imports.ui.main.wm.addKeybinding()` seems to be the way to bind specific
key to a javascript code.

### GNOME extension "More keyboard shortcuts"

[More keyboard shortcuts](https://github.com/matthijskooijman/gnome-shell-more-keyboard-shortcuts)
also looked like simple enough since all it does is
switching window on the current workspace
when `<Super>j`  or `<Super>k` is pressed.

This source has its own `schemas/org.gnome.shell.extensions.more-keyboard-shortcuts.gschema.xml` with `<default><![CDATA[['<Super>j']]]></default>` and `<default><![CDATA[['<Super>k']]]></default>` for `<key type="as" name="switch-window-next-workspace">` and `<key type="as" name="switch-window-prev-workspace">`.

I suppose this `CDATA` thing is the same thing as `<default>["&lt;Super&gt;j"]</default>` and `<default>["&lt;Super&gt;k"]</default>`.

I also see `extension.js` has the following which binds "key name" to javascript.
```
function enable() {
    Main.wm.addKeybinding("switch-window-next-workspace",
        settings,
        Meta.KeyBindingFlags.NONE,
        Shell.ActionMode ? Shell.ActionMode.NORMAL : Shell.KeyBindingMode.NORMAL,
        function(display, screen, window, binding) {
            switchWindow(true);
        }
    );
    Main.wm.addKeybinding("switch-window-prev-workspace",
        settings,
        Meta.KeyBindingFlags.NONE,
        Shell.ActionMode ? Shell.ActionMode.NORMAL : Shell.KeyBindingMode.NORMAL,
        function(display, screen, window, binding) {
            switchWindow(false);
        }
    );
}
```

By replacing `switchWindow()` with Input Method setting javascript function, I
think I can get desired extension.  See my result at:

- [Keyboard shortcuts for switching input methods under GNOME shell](https://github.com/osamuaoki/inputmethod-shortcuts)

I also updated [GNOME extensions for better UX]({{<ref note-00045.md>}}).
<!-- vim: set sw=4 sts=4 ai si et tw=79 ft=markdown: -->
