---
title: "Re-learning Vim (8)"
date: 2024-06-04T00:00:00+00:00
categories:
  - desktop
  - english
tags:
  - vim
slug: vim-learn-8
---

## Nvim configuration retrospective

I have been updating Nvim configuration with LazyVim as described in
[Re-learning Vim (7)]({{< ref "note-00040.md" >}}) to make it behave as close
as plain Nvim.

## Vim configuration touch-ups

In order to make my Vim experience to match my LazyVim/Nvim configuration, I
updated my `.vimrc`.

* [osamu's ~/.vimrc file](https://github.com/osamuaoki/dot-vim/blob/master/.vimrc)

## Folding of markdown file

I have always used `gq` under visual line mode to rewrap range of lines within
`'textwidth`.  Since LazyVim sets `'formatexpr`, it doesn't work as expected
any more for some `'filetype` such as `markdown`.

Easy workaround is to use `gw` instead.

## Revising basics -- quickfix

I feel I need to revisit some key baseline Vim operation techniques beyond the
use of keyboard MACRO.

Let's look into "Quickfix list" and "location list".
* "Quickfix list" is a Vim global list.
* "Location list" is a window-local list.

"Quickfix list" and "location list" are essentially a jump table data generated by:

* error outputs from compiler `:make`
* text search with internal regex `:vim /{pattern}/ ##`
* text search with external regex `:gr '{pattern>' ##`


| "quickfix list"    | "location list"     | functionality              |
|--------------------|---------------------|----------------------------|
| `:vim[grep]`         | `:lv[imgrep]`         | Vim internal search        |
| `:gr[ep]`            | `:lgr[ep]`            | Vim external search        |
| `:helpg[rep]`        | `:lh[elpgrep]`        | Help message search        |
| `:mak[e]`            | `:lmak[e]`            | Error messsage search      |
| `:cope[n]`           | `:lop[en]`            | Open list of errors/matches |
| `:ccl[ose]`          | `:lcl[ose]`           | Close list of errors/matches |
| `:cdo {cmd}`         | `:ld[o] {cmd}`        | Execute `{cmd}` for all errors/matches |
| `:cc`                | `:ll`                 | Display error/match        |
| `:cn[ext]`           | `:ln[ext]`            | Display next error/match   |
| `:cp[revious]` or `:cN` | `:lp[revious]`  or `:lN` | Display previous error/match |
| `:cfir[st]`          | `:lfir[st]`           | Display first error/match |
| `:cla[st]`           | `:lla[st]`            | Display last error/match |
| `:cli[st]`           | `:lli[st]`            | List all errors/matches |
| `:col[der]`          | `:lol[der]`           | Open older list of errors/matches |
| `:cne[wer]`          | `:lne[wer]`           | Open newer list of errors/matches |

Here, `{cmd}` in the above for `:cdo` is Ex-command like `s/foo/bar/gc`.

LazyVim and my updated `~/.vimrc` map `[q` and `]q` to `:cprevious<cr>` and
`:cnext<cr>` for easy navigation.

Unless I get to do very complicated things, I should be OK just using global
quickfix list.

## Ex-mode command line

There are special characters for EX-mode command line.

* `##` : substitute with all names in the argument list when executed
* `%` : substitute with the current file name when executed
* `<c-r>%` : insert the current file name to the command line
* `%<tab>` : insert the current file name to the command line

If the faster `rg` (`ripgrep` package) is used for `:grep`, it can offer
optimal recursive tree search from the current working tree by
not-specifying the target file in Ex-mode command line.

The wildcard expression such as `*`, `*.txt`, `**.md`, ..., parsed by the
underlining shell (Bash) may be useful.

## Use case (manual changes)

* At shell prompt, enter: `vi file1.txt file2.txt`
* In Vim/Nvim normal mode, enter `: gr 'pattern' ##`
* Open quickfix window with `:copen`
* Move and press within quickfix window to jump to matching location in target files.
* Use `]q` or `[q` to navigate in target files and make manual changes.
* Close quickfix window with `:cclose`
* Save all and quit with `:wqa`

## Use case (automatic changes)

* At shell prompt, enter: `vi file1.txt file2.txt`
* In Vim/Nvim normal mode, enter `:gr 'pattern' ##`
* Substitute all with confirmation with `:cdo 's/pattern/subststring/gc'`
* Save all and quit with `:wqa`

## Filter quicklist contents

Use `exclude_pattern` and `include_pattern` (vim internal regex).

* ...
* Load `cfilter` with: `:packadd cfilter` (if not done yet)
* Remove matched from quicklist with `:Cfilter! /exclude_pattern/`
* Select matched in quicklist with `:Cfilter /include_pattern/`

(I updated `~/.vimrc` and `~/.config/nvim/lua/config/lazy.lua`)

This is quite handy to trim down quicklist to run `:cdo {cmd}` script.

`:col` and `:cnew` are handy for this type of operation.

## Regex dialects

* Case sensitive regex:
  * `(?-i)` in the pattern for `rg` (POSIX 1003.2 regular expressions)
  * `\C` in the pattern for Vim internal
  * `-i` in the command option for grep
* Case **in**sensitive regex:
  * `(?i)` in the pattern for `rg` (POSIX 1003.2 regular expressions)
  * `\c` in the pattern for Vim internal
  * `--no-ignore-case` in the command option for grep

All modern platforms, such as Perl, Python, Rust, ..., support POSIX 1003.2
regular expressions.  So be careful for Vim RE.

Since I use `rg` or Vim internal regex, I decided to keep their default to be
smart case and set them as needed to be specific ones.


<!-- vim: set sw=4 sts=4 ai si et tw=79 ft=markdown: -->
