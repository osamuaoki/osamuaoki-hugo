---
title: Virtual machine with INCUS (7)
date: 2024-03-13T00:00:00+00:00
categories:
  - desktop
  - english
tags:
  - lxc
slug: lxc-7
---

Here is a series of memos of me trying to use LXC/LXD and INCUS on Debian 12 (`bookworm`).

In order to make full transition to `incus`, I will trace what I did with `lxc`
with `incus` while addressing not only container systems but also virtual
machine systems.

## Start Container and VM with Incus

Let me trace [Container with LXC/LXD (1)]({{< ref "note-00050.md">}}).

Since I have enough CPU and memory, I started container systems and VM systems
as follows.

```console
 $ incus launch images:debian/12       ct       -c limits.cpu=4 -c limits.memory=4GiB
 $ incus launch images:debian/12/cloud ctc      -c limits.cpu=4 -c limits.memory=4GiB
 $ incus launch images:debian/12       vm  --vm -c limits.cpu=4 -c limits.memory=4GiB
 $ incus launch images:debian/12/cloud vmc --vm -c limits.cpu=4 -c limits.memory=4GiB
```
After some time for DHCP resolution:

```console
 $ incus ls
+------+---------+-------------------------+------------------------------------------------+-----------------+-----------+
| NAME |  STATE  |          IPV4           |                      IPV6                      |      TYPE       | SNAPSHOTS |
+------+---------+-------------------------+------------------------------------------------+-----------------+-----------+
| ct   | RUNNING | 10.214.117.246 (eth0)   | fd42:4c3b:8e2d:60d:216:3eff:fe75:d242 (eth0)   | CONTAINER       | 0         |
+------+---------+-------------------------+------------------------------------------------+-----------------+-----------+
| ctc  | RUNNING | 10.214.117.158 (eth0)   | fd42:4c3b:8e2d:60d:216:3eff:fe7b:9c42 (eth0)   | CONTAINER       | 0         |
+------+---------+-------------------------+------------------------------------------------+-----------------+-----------+
| vm   | RUNNING | 10.214.117.171 (enp5s0) | fd42:4c3b:8e2d:60d:216:3eff:fe0a:a43d (enp5s0) | VIRTUAL-MACHINE | 0         |
+------+---------+-------------------------+------------------------------------------------+-----------------+-----------+
| vmc  | RUNNING | 10.214.117.118 (enp5s0) | fd42:4c3b:8e2d:60d:216:3eff:fefb:e649 (enp5s0) | VIRTUAL-MACHINE | 0         |
+------+---------+-------------------------+------------------------------------------------+-----------------+-----------+
```
As I check default primary user's GID issue:

```console
 $ incus exec ct -- grep ":1000:" /etc/passwd
 $ incus exec vm -- grep ":1000:" /etc/passwd
 $ incus exec ctc -- grep ":1000:" /etc/passwd
debian:x:1000:1001:Debian:/home/debian:/bin/bash
 $ incus exec vmc -- grep ":1000:" /etc/passwd
debian:x:1000:1001:Debian:/home/debian:/bin/bash
```
Now I know that

* basic image doesn't have the primary user
* cloud image has the primary user created by cloud-init with obscure GID.

<!--

## Profile `osamu` for `cloud-init`

Let's create my default profile to fix this obscure GID.

```console
 $ incus profile show default
config: {}
description: Default Incus profile
devices:
  eth0:
    name: eth0
    network: incusbr0
    type: nic
  root:
    path: /
    pool: default
    type: disk
name: default
used_by:
- /1.0/instances/ct
- /1.0/instances/vm
- /1.0/instances/ctc
- /1.0/instances/vmc
 $ vi osamu.yaml
 $ cat osamu.yaml
description: Osamu's default Incus profile
config:
  user.user-data: |
    users:
    - name: osamu
      groups: [adm, mail]
devices:
  eth0:
    name: eth0
    network: incusbr0
    type: nic
  root:
    path: /
    pool: default
    type: disk
 $ incus profile create osamu
 $ incus profile edit osamu < osamu.yaml
```

```console
 $ incus delete -f ctc vmc
 $ incus launch images:debian/12/cloud ctc -c limits.cpu=4 -c limits.memory=4GiB --profile=osamu
 $ incus launch images:debian/12/cloud vmc --vm -c limits.cpu=4 -c limits.memory=4GiB --profile=osamu
 $ incus launch images:debian/12/cloud vmc --vm -c limits.cpu=4 -c limits.memory=4GiB --profile=osamu
Launching vmc
 $ incus launch images:debian/12/cloud ctc  -c limits.cpu=4 -c limits.memory=4GiB --profile=osamu
Launching ctc


## Tracing [Container with LXC/LXD (2)]({{< ref "note-00053.md">}})






## Tracing [Container with LXC/LXD (3)]({{< ref "note-00054.md">}})



## Tracing [Container with LXC/LXD (4)]({{< ref "note-00055.md">}})



## Tracing [Container with LXC/LXD (5)]({{< ref "note-00056.md">}})


-->

<!-- vim: set sw=4 sts=4 ai si et tw=79 ft=markdown: -->
