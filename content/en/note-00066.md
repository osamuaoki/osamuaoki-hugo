---
title:  Ansible (2)
date: 2024-02-19T00:00:00+00:00
categories:
  - desktop
  - english
tags:
  - ansible
slug: ansible-2
---

Here is a series of memos of me trying to use ansible on Debian 12 (`bookworm`).

## Searching roles in Ansible Galaxy and `ansible-galaxy`

[Ansible Galaxy](https://galaxy.ansible.com/ui/) is a curation site for Ansible
scripts.  They are offered in 2 formats:

* [Roles](https://galaxy.ansible.com/ui/standalone/roles/) -- data downloaded as "`git clone ...`".
* [Collections](https://galaxy.ansible.com/ui/collections/) -- data downloaded in "`*.tar.gz`" format.

Actual data seems to be comming from github.repository.

They tend to address generic administration tasks on remote hosts and a bit
complicated.  Let me use them as examples to learn Ansible.

## Creating an initial system setup playbook

Let me expand 
[Playbook to install multiple packages (use roles)]({{< ref "note-00065.md" >}}/#playbook-to-install-multiple-packages-use-roles)
to create an initial system setup playbook.
.

### Creating a full project template with `ansible-galaxy`

Let's create a full project template with `ansible-galaxy` as:

```console
 $ cd /path/to/ansible-config-data/
 $ ansible-config init --disabled >ansible.cfg
 $ sed -i -e '/^;inventory/s/^*$/inventory=inventory.yml/' ansible.cfg
 $ cat >inventory.yml << EOF
---
all:
  hosts:
    localhost:
      ansible_connection: local
EOF
 $ ansible-galaxy init roles/base
```

This creates a source template.  Let's merge what was presented in 
[Playbook to install multiple packages (use roles)]({{< ref "note-00065.md" >}}/#playbook-to-install-multiple-packages-use-roles) to this.

```
 $ tree
.
├── README.md
├── ansible.cfg
├── inventory.yml
├── pb_main.yml
└── roles
    └── base
        ├── README.md
        ├── defaults
        │   └── main.yml
        ├── files
        ├── handlers
        │   └── main.yml
        ├── meta
        │   └── main.yml
        ├── tasks
        │   ├── install.yml
        │   ├── main.yml
        │   ├── remove.yml
        │   └── upgrade.yml
        ├── templates
        ├── tests
        │   ├── inventory
        │   └── test.yml
        └── vars
            └── main.yml
```

There are

* good old keys:`tasks`, `vars`
* some new keys: `defaults`, `handlers`, and `meta`
* some data file paths: `files`, `templates`
* test project path: `tests`

### Execute shell script

** TBD **

### Copy configuration file

** TBD **

### Create directory with file module

** TBD **


<!--

## Handler

- [Handler](https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_handlers.html)


Writing one big playbook in the base directory is messy.

The [playbook](https://docs.ansible.com/ansible/latest/playbook_guide/playbooks.html) can be organized using:

- [Blocks](https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_blocks.html) -- logical groups of tasks
- [Roles](https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_reuse_roles.html) -- let you automatically load related vars, files, tasks, handlers, and other Ansible artifacts based on a known file structure.
- [Tags](https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_tags.html) -- let you execute or skip selected tasks


Using these, the [playbook](https://docs.ansible.com/ansible/latest/playbook_guide/playbooks.html) can be split into 4 types of independent files:

- variables files
- task files
- playbooks files
- roles files

"[Creating reusable files and roles](https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_reuse.html)" explains how to use these.


-->

<!--
Trace points

https://zenn.dev/y_mrok/books/ansible-no-module-no-tsukaikata
https://stackoverflow.com/questions/74869900/ansible-playbooks-install-a-list-of-apt-packages-from-a-file
https://noknowing.hatenablog.com/entry/2021/01/01/163331
https://noknowing.hatenablog.com/entry/2021/01/01/053854
https://noknowing.hatenablog.com/entry/2020/12/31/153924
https://noknowing.hatenablog.com/entry/2021/01/02/130032 docker nginx
https://knowledge.sakura.ad.jp/3116/

Similar examples referenced
https://github.com/sys0dm1n/ansible-ubuntu-desktop
https://github.com/rpthms/ansible-debian-server
https://github.com/gh640/ansible-playbook-localhost-examples

-->

<!--
vim: set sw=2 sts=2 ai si et tw=79 ft=markdown:
-->
