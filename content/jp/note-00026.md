---
title: 仮想環境(1)
date: 2020-12-13
categories:
  - virtual
  - japanese
tags:
  - chroot
slug: virt-01
---

## 開発環境の基本

開発環境は、できるだけ安定しているほうがストレスが少ないです。stable環境が使えればそれでも
いいのですが、新しいハードウエアーだとtestingぐらいは必要かもしれません。

通常のパッケージ作成には、確実に sid/unstable 環境とするために
`pbuilder`/`cowbuilder` を使って
[設定](https://www.debian.org/doc/manuals/debmake-doc/ch03.en.html#pbuilder-setup)
された仮想化された
[chroot環境](https://www.debian.org/doc/manuals/debmake-doc/ch07.en.html#chroot)
を使っています。(確かに、`schroot`/`sbuild` 系の方が良い面はあるのでしょうが、
これは私の惰性による選択です。)

pbuilderでパッケージビルドをすると、開発環境をsidにしなくてもパッケージが正しいsid環境
で作成でき快適です。

## デバグ用の仮想環境作成

最近、なるべくメインのシステムを変えずにデバグを効率的にするために、
いくつかのパッケージがインストールされたデバグ用の仮想化されたchroot環境を
上記の延長線上で準備しました。

`cowbuilder` を使って、`~/wip`以下にchrootの開発環境を作成します。

```
 $ sudo cowbuilder create --basepath ~/wip
...
 $ sudo cowbuilder login --basepath ~/wip
...
 root@goofy:/# apt-get install git vim mc aptitude devscripts iproute2
...
 root@goofy:/# ^D
```

後は、この環境に以下で使う度にログインして、root環境で各種コマンドを使います。


```
 $ sudo cowbuilder login --basepath ~/wip
...
 root@goofy:/# cd
...
 root@goofy:~#
```

作業用のソースはchroot環境中の`/root`にコピーを置いて作業することになります。ここは
ホスト環境から見ると`~/wip/root`以下になります。このディレクトリのパーミッションは
`drwx------`で、オーナーが`root root`です。当然ですが、root権限がないとアクセスでき
ないのでホスト環境からの操作時には配慮が必要です。

確かにrootユーザーのままで色々やるのは「少々気持ちが悪い」ですが、
所詮chroot環境なのでダメージは限定的と考え「良」とします。

キャラクターコンソールのみを使うコンパイル等にはchroot環境程度の簡単な仮想化で充分です。
（GUIへのアクセス等は仮想化に`kvm`環境が必要）

## ソースパッケージ作成

最近のsource only uploadのためには ソースに対して`dpkg-buildpackage -S --no-sign`
を実行する必要があります。このためだけに開発のホストシステム全体をSid環境にして
依存関係で必要とされる関連パッケージを大量インストールするのは気が向きません。

この実行を開発環境デバグ用のchroot環境ですれば、開発環境を肥大化させずに開発環境を
安定して確保できます。

<!-- vim: sw=2 sts=2 et se ai tw=79: -->
