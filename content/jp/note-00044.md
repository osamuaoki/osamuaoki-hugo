---
title: QWFRTY配列
date: 2022-02-14
categories:
  - iot
  - japanese
tags:
  - qwfrty
slug: qwfrty
---

## 背景

MCUを使ったIOTの初等プロジェクトとして、[cgc56というQMKを利用したキーボード](https://github.com/osamuaoki/cg56)を作りました。

![4x14 ortholinear配列キーボード(cgc56)](/img/cgc56.jpg)

今回完成したキーボードは、PLANCKより4x14と幅があることを利用して、左右の手の間隔をとり、真ん中の余裕の部分に頻出記号キーを押し込んでいます。

* PLANCKよりは普通のキーボードに近いキー配列になっています。
* 2つあるFnキーのうち１つ押しだと数字・記号・F1-F12キーです。(現状、ほぼ左右の差はありません)
* Fnキー２つ同時押しでカーソールキーにアクセスできます。ちょうどこれがQWFRTY配列だとVIMの「`hjkl`」と同じ位置です。
* Fnキー無しのデフォルトのキー配列は、QWERTY配列とQWFRTY配列が切り替えられます。
* 更にFnキーにより、キー配列が変化します。

![cgc56 full](/img/cgc56-4.png)

元データー: [cgc56 キーボードデータ 全体](http://www.keyboard-layout-editor.com/#/gists/faf55be2e2240ece6e2a82f5aba8add2)

使ってみて意外とおもしろいので、ここに要点等をメモしておきます。

ずぼらな性格上、DVORAK, COLMAK, WORKMAN, COLEMAK-DHのいずれも学習障壁が高すぎました。(これらの有名配置だと、VIエディターでのカーソール移動も難しくなってしまいます)。

元々は中指を伸ばして「`E`」を叩きづらいという個人的課題解決目的のキーボードプロジェクトでした。これだけなら`E`と`F`のスワップで済ますのも良いのですが、それだけでは勿体ないので、苦労しない範囲でDVRAKの交互打鍵に近づけられないかと考えた妥協点案が「QWFRTY配列」です。これはあくまでQMKを利用した自作キーボードの最適化キー配列実験で、私の日常生活はQWERTY配列です。

ちなみに、押されたキーのチェックやNKRO機能のチェックには、以下が便利でした。
* [Keyboard ghosting interactive demonstration](https://www.microsoft.com/applied-sciences/projects/anti-ghosting-demo)
* [Keyboard Ghosting Demonstration](https://drakeirving.github.io/MultiKeyDisplay/)

## QWFRTY配列

「QWFRTY配列」は、11個のキーだけが標準の「QWERTY配列」から移動された配列です。

名前は、１文字違いでややこしいですが、「**QWFRTY配列**」としました。キーは位置の要点を抜き出すと以下です。
```
       LEFT HAND                 RIGHT HAND
│ Q │ W │_F_│ R │ T │      │ Y │_D_│_K_│_G_│ P │
│ A │_I_│_U_│_E_│_O_│      │_S_│_H_│_J_│ L │ ; │
│ Z │ X │ C │ V │ B │      │ N │ M │ , │ . │ / │
```

まあ、所詮実験レベルのお遊びですが、我ながら悪くない気もします。

### QWERTY配列からの変更点（覚え方）:

キーの移動を以下の様にとらえると覚えられます。

* "IUEO"は５０音順に"A"に続けて配列。 ("E"は"F"と場所交換、"SDG"は外しておく)
* "HJKL"を逆Tのカーソールキー位置関係に移動。("L"を軸に1つづつ移動、ホームを空ける)
* "SDG" をこの順番・位置関係を維持しながらで右の空きスペースに順番に移動。(この移動だけは覚える必要有り)

### QWFRTY設計の方針と結果:

* 母音 (AIUEO) を左手に集めるDVORAK/EUCALYN配列のコンセプトは継承。
    * 交互打鍵をでき、特に日本語との相性も良い。
    * 母音文字順はDVORAK/EUCALYN配列と変えて、頻出の"E"をホームの動きの良い人差し指の下に移動。
    * ５０音順キー配列としたので、日本人に覚えやすい
    * それなりによく使う"S"と"D"は、反対側の動きの良い人差し指操作の範囲に移動。
* キー移動を必要最小限化する COLEMAK/WORKMAN配列のコンセプトは継承。
    * QWERTYからの移行のメンタルストレスを最小限にできる。
* EUCALYN配列の VIMのカーソールキー (HJKL) をまとめるアイデアを拝借
    * 大きなキー移動を避けるため、"L"は動かさなかった。
    * QWERTYよりむしろ使い安くなった（？）
    * "S"と"D"がくるアクセスの良いスペースが空いたので一石二鳥。
    * Fn-Fnでアクセスする、本当のカーソールキーと同じ位置となった。

### QWFRTY配列のキー移動の統計と可学習性:

* 11/30のキーが移動(下記の他の有名配列の半分近くなので、覚えやすい)
* 気分的には、"SDG"の3つのキーの新場所を覚えるだけ程度の、楽な学習障壁感。

### QWFRTY設計の背景事実：

#### 文字数頻度指標

(log圧縮済み、QMKのソース利用)は以下です。（大きいほどよく出てくるので、使いやすいところに置きたい文字）

* `s=26.2 d=26.2 f=16.9 g=9.4` `*.c` `*.h`
* `s=20.1 d=14.4 f=8.2  g=6.7` `*.md`

#### 交互打鍵・日本語入力

"f" は日本ではあまり使わない子音なので、交互打鍵を考えた際にも子音だが母音側にあっても"g"より悪影響が少ない。英語環境では、ともに中以下の頻度なので大差ない。

#### 右配置の移動文字間の優先順位

`s > d > g`

## 世の中にある有名キー配列

* https://yushakobo.jp/blog/pluis9/2017/12/thinkkeylayout/

標準の「QWERTY配列」以外は、新しいキー配列提案が先に並んでいます。

以下は重要30キーにのみフォーカスし、Ortholinear系・ERGODOX系を意識した位置表示です。

### QWERTY配列
```
       LEFT HAND                 RIGHT HAND
│ Q │ W │ E │ R │ T │      │ Y │ U │ I │ O │ P │
│ A │ S │ D │ F │ G │      │ H │ J │ K │ L │ ; │
│ Z │ X │ C │ V │ B │      │ N │ M │ , │ . │ / │
```
* 0/30キーが移動(デフォルト)

### Eucalyn

* https://eucalyn.hatenadiary.jp/entry/saikyo-interface (2017-12-21 初期形)
```
│ / │ , │ . │ F │ Q │      │ M │ R │ D │ Y │ P │
│ A │ O │ E │ I │ U │      │ G │ T │ K │ S │ N │
│ Z │ X │ C │ V │ W │      │ B │ H │ J │ L │ ; │
```
* 23/30キーが移動

* https://eucalyn.hatenadiary.jp/entry/about-eucalyn-layout (2018-08-31 完成形)
```
│ Q │ W │ , │ . │ ; │      │ M │ R │ D │ Y │ P │
│ A │ O │ E │ I │ U │      │ G │ T │ K │ S │ N │
│ Z │ X │ C │ V │ F │      │ B │ H │ J │ L │ / │
```
* 20/30キーが移動

### Colemak Mod-DH

* https://colemakmods.github.io/mod-dh/
```
│ Q │ W │ F │ P │ B │      │ J │ L │ U │ Y │ ; │
│ A │ R │ S │ T │ G │      │ M │ N │ E │ I │ O │
│ Z │ X │ C │ D │ V │      │ K │ H │ , │ . │ / │
```
* 17/30キーが移動

### WORKMAN

* https://workmanlayout.org/
```
│ Q │ D │ R │ W │ B │      │ J │ F │ U │ P │ ; │
│ A │ S │ H │ T │ G │      │ Y │ N │ E │ O │ I │
│ Z │ X │ M │ C │ V │      │ K │ L │ , │ . │ / │
```
* 21/30キーが移動

### Colemak

* https://colemak.com/
```
│ Q │ W │ F │ P │ G │      │ J │ L │ U │ Y │ ; │
│ A │ R │ S │ T │ D │      │ H │ N │ E │ I │ O │
│ Z │ X │ C │ V │ B │      │ K │ M │ , │ . │ / │
```
* 19/30キーが移動

### Dvorak mod-slash

* https://en.wikipedia.org/wiki/Dvorak_keyboard_layout

```
│ / │ , │ . │ P │ Y │      │ F │ G │ C │ R │ L │
│ A │ O │ E │ U │ I │      │ D │ H │ T │ N │ S │
│ ; │ Q │ J │ K │ X │      │ B │ M │ W │ V │ Z │
```
* 28/30キーが移動

適用対象がOrtholinear配列のため「`'`」が「`/`」となっている。（どのキー配列でも、「`'`」は真ん中の上記枠外の隙間に配置済み）

## 文字頻度

QMK の`quantum/`中や`docs/`中を統計して、スペースの数を１００としている。"`*`"はログ圧縮して大局観が分かるようになっています。

```
Cソースコード                  ドキュメンテーション中
" "  = 100.0 **********
"e"  = 61.9 *********          "e"  = 37.7 ********
"t"  = 41.0 ********           "t"  = 27.7 *******
"a"  = 32.2 ********           "a"  = 22.2 *******
"i"  = 38.3 ********           "i"  = 22.1 *******
"o"  = 31.4 *******            "o"  = 23.4 *******
"n"  = 30.7 *******            "n"  = 19.4 *******
"r"  = 30.3 *******            "r"  = 19.4 *******
"s"  = 26.2 *******            "s"  = 20.1 *******
"d"  = 26.2 *******            "d"  = 14.4 ******
"c"  = 23.7 *******            "c"  = 13.3 ******
"l"  = 18.2 *******            "l"  = 13.5 ******
"f"  = 16.9 ******             "f"  =  8.2 *****
"u"  = 15.4 ******             "u"  = 10.9 ******
"m"  = 14.3 ******             "m"  =  9.8 *****
"p"  = 13.9 ******             "p"  =  8.3 *****
"k"  = 10.6 ******             "k"  =  5.5 ****
"h"  = 10.3 ******             "h"  = 11.1 ******
"b"  =  9.5 *****              "b"  =  6.5 *****
"g"  =  9.4 *****              "g"  =  6.7 *****
"y"  =  9.3 *****              "y"  =  6.5 *****
"v"  =  5.9 *****              "v"  =  3.3 ****
"w"  =  5.7 *****              "w"  =  4.4 ****
"x"  =  5.5 ****               "x"  =  1.6 **
"q"  =  0.9 *                  "q"  =  1.0 **
"j"  =  0.5 *                  "j"  =  0.3 *
"z"  =  0.5 *                  "z"  =  0.2 *
````

ここで高頻度の子音文字「tnrsdcl」の非母音側への集中度と母音集中側の母音の数をみます：

|キー配列 | 頻出子音字集中| 母音集中| キー移動数 |
|---------|:----------------:|:----------:|:----:|
| QUERTY    |   5/7       |     3/5   |0 |
| **QUFRTY**  |   4/7     |     5/5   |11 |
| Colemak dh|   5/7       |     4/5   |17 |
| Colemak   |   5/7       |     4/5   |19 |
| Eucalyn   |   6/7       |     5/5   |20 |
| WORKMAN   |   5/7       |     4/5   |21 |
| DVRAK     |   7/7       |     5/5   |28 |

**QWFRTY**
はキー移動を避けたため、最頻出の「`T`」が母音側のままという問題が出ています。
でも`TH`などの子音同士の連続の交互打鍵は確保できていますので、捨てたものではありません。
とにかく変更が少なく、母音が集中するのがいい感じです。
（確かに`T`と`Y`の交換で改善しますが、キー移動数が増えるのと`TH`が隣接等のマイナスもあります。過ぎたるは及ばざるが如しです。）

ちなみにC言語のソースの場合、記号でスペース比較で約４％以上の頻度は以下だけでした。

```
" "  = 100.0 **********
"_"  = 35.9 ********
"("  = 10.5 ******
")"  = 10.5 ******
";"  =  7.0 *****
","  =  6.7 *****
"#"  =  6.2 *****
"*"  =  6.2 *****
"."  =  4.4 ****
"/"  =  6.4 *****
"0"  =  6.3 *****
"="  =  4.8 ****
"""  =  3.5 ****
```

## 余談

キーボードの全体感の再確認のため、主要キーの配置をFnキー状態違いも含めて重ね書きすると以下となります。

![QWFRTY詳細](/img/QWFRTY.png)

[cgc56 QWFRTY キーボードデータ 詳細版](http://www.keyboard-layout-editor.com/#/gists/bb66579d5945aafb78ffca0227cb87f0)。
当分色々変更して遊びそうなので、最新の状況は、[私のQMKソース](https://github.com/osamuaoki/qmk_firmware/blob/osamu1/keyboards/cgc56/keymaps/default/keymap.c)を確認するのが一番確実ではあります。( どうも親指を置くFn-キーの間隔を１つ外にずらした方が手首が楽かな、、、、でもそうでもない。やっぱりスプリットデザインにするべきかな、、、、)

上記統計結果もあって、「`_` 」 はスプリット直交配置の真ん中に特別にシフト無しでアクセスできるようにしてます。
また"("と")"は定位置のFn片押しの","と"/"以外に、Fn両押しですが押しやすい真ん中にも配置しました。

さらに、スペースキーは、実質4つあります。`shift`, `control`, `Fnl1`, `Fnl2`とをタップ・ホールド区別を使って兼用です。真ん中の`shift`や`Control`は、`Enter`やFn押しての`Backspace``Backspace`との兼用です。

日本語入力切り替えは、確定論的挙動としたいので`alt-`&#96;トグルではなく`shift-space` や`control-space`でローマ字かな入力と英字入力の間を往復してます。(この設定はMac風の気がします。[GNOME環境](/jp/2019/03/23/gnome-uskb-im-select/)や[WINDWS環境](https://www.lifehacker.jp/article/235889windows10-typing-tips/)だと必ずしもデフォルトではないですが簡単に設定実現できます。)
この変換関連でのスペース多用の際の使い勝手は実際のキーボードでは細かい配慮がされています。右の`control`をホールドから左のタップか、はたまた左の`shift`をホールドしてから右のタップかでローマ字かな入力と英字入力の間を往復できます。この際に既にホールドしていない中心付近の３つのどのキーをタップしてOKといった感じです。

`Fn`キーの両押しでの連続のカーソール操作は辛いので、`Fn`キーの使用無しで同じ位置でカーソール操作出きるような配列レイヤー(LKL2)も準備しています。(一時、ラップトップPCの様に、キーボードの右下端での直接カーソールアクセスも試しましたが、ホームポジションから大きく手を動かしの操作となるのであまりよくなかったです。)

ちなみに、`Fn`キーは２つあり、片押しで２つのレーヤー対応が出きるようになっています。ほぼ全く同じデーターが今入っているので、どっちを押してもほぼ変わりません。

当面、１４”のノートパソコン(Thinkpad T14 Gen1)に無いキーはいらないと割り切っています。必要なら追加の１０キーパッドを用意するのでしょう。

PLANCK他のキーボードより幅が有り、一体型ですが両手間隔がとれ猫背にならずに使えます。

従来のキーボード両端の小指で操作する旧来のシフトキー類も残していますが、ERGODOX等で見るThumbクラスター風のタイピングでのシフトキー類の操作が出きます。シフトキー類と文字キーの両押しの押し方の自由度が増え、手にやさしい押し方への移行の際に学習障壁が減り助かります。
[Alice配列](https://salicylic-acid3.hatenablog.com/entry/key-layout)にしなくとも、端のキー（特に下の角のキー）を基本使わないと、手首へのストレスも下げられます。

ちなみに、母音文字を集める際に採用した"AIUEO"配列ですが、「なぜ"E"の使用指が変わらない配列や、はたまた他の配列でないのか？」と問われたら、「特段の理由はないが、中指使用を抑えたい個人的事情と、キー位置の覚えやすさ」というのが実感です。DVORAK配列の"AOEUI"や、頻度での優先順位を考えた"AOIEU"や"AOEIU"でも充分いい気がします。

とにかく、ここまでの細かい個人的事情にも自由に対応できるのがQMKキーボードの良いところです。充分楽しめます。

最後に、vimで`inoremap jk <ESC>`等としてたら、ホームのみの`inoremap jj <ESC>`や`inoremap jh <ESC>`等とでもする方が良いかもしれません。

<!-- vim: se ai tw=79: -->


