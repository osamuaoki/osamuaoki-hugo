---
title: QWFRTY配列
date: 2022-02-14
categories:
  - iot
  - japanese
tags:
  - qwfrty
slug: qwfrty
---

## 背景

MCUを使ったIOTの初等プロジェクトとして、[cgc56というQMKを利用したキーボード](https://github.com/osamuaoki/cg56)を作りました。

![4x14 ortholinear配列キーボード(cgc56)](/img/cgc56.jpg)

デフォルトのキー配列に採用したのは、QWERTY配列でした。ずぼらな性格上、DVORAK, COLMAK, WORKMAN, COLEMAK-DHのいずれも学習障壁が高すぎました。(これらの有名配置だと、VIエディターでのカーソール移動がVIのデフォルト設定では難しくなってしまいます。)

ただ、元々は中指を伸ばして「`E`」を叩きづらいという個人的課題解決目的のキーボードでした。これだけなら`E`と`F`のスワップで済ますのも良いのですが、それだけでは残念なので、苦労しない範囲でDVRAKの交互打鍵に近づくために「QWFRTY配列」を考え、最適化配列を考えてみました。

![QWFRTY簡単](/img/QWFRTY-simple.png)

[cgc56 QWFRTY キーボードデータ 簡易版](http://www.keyboard-layout-editor.com/#/gists/5d4ef725c32a4cbb8f4566a2de603527)

使ってみて意外とおもしろいので、ここに要点等をメモしておきます。

小さなキーボードでカーソールやINSまで押し込んだので、実際には最右下のキーは、カーソルキーが割り込みもう一つ右に離れています。
ただ直交系キーボード配列なので、比較的に使わない"/"キーだし、元々下のキーQWERTYよりは左によっているので問題はないようです。
ちなみに今回完成したキーボードは、PLANCKより4x14と幅があることを利用して、左右の手の間隔をとり、できた真ん中の余分の部分に頻出記号キーを押し込んでいます。

## QWFRTY配列

私は、せっかく作ったQMKを利用した自作キーボードのいわゆる最適化キー配列として、11個のキーだけが標準の「QWERTY配列」から移動された配列としています。

名前は、１文字違いでややこしいですが、「**QWFRTY配列**」としました。キーは位置の要点を抜き出すと以下です。
```
       LEFT HAND                 RIGHT HAND
│ Q │ W │_F_│ R │ T │      │ Y │_D_│_K_│_G_│ P │
│ A │_I_│_U_│_E_│_O_│      │_S_│_H_│_J_│ L │ ; │
│ Z │ X │ C │ V │ B │      │ N │ M │ , │ . │ / │
```

まあ、所詮実験レベルのお遊びですが、我ながら悪くない気もします。

### QWERTY配列からの変更点（覚え方）:

キーの移動を以下の様にとらえると覚えられます。

* "IUEO"は５０音順に"A"に続けて配列。 ("E"は"F"と場所交換、"SDG"は外しておく)
* "HJKL"を逆Tのカーソールキー位置関係に移動。("L"を軸に1つづつ移動、ホームを空ける)
* "SDG" をこの順番・位置関係を維持しながらで右の空きスペースに順番に移動。

### QWFRTY設計の方針と結果:

* 母音 (AIUEO) を左手に集めるDVORAK/EUCALYN配列からコンセプトは継承。
    * 交互打鍵をでき、特に日本語との相性も良い。
    * 母音文字順は変えて、頻出の"E"をホームの動きの良い人差し指の下に移動。（順番もこの方が５０音順で覚えやすい）
    * それなりによく使う"S" "D"は動きの良い人差し指で操作の位置に移動。
* キー移動を必要最小限化する COLEMAK/WORKMAN配列のコンセプトは継承。
    * QWERTYからの移行のメンタルストレスが少ない。
* EUCALYN配列の VIMのカーソールキー (HJKL) をまとめるアイデアを拝借
    * QWERTYよりむしろ使い安くなった（？）

### QWFRTY配列のキー移動の統計と可学習性:

* 11/30のキーが移動(下記の他の半分なので、覚えやすい)
* 大移動した、9/30キーのみの移動を実質覚えれば良い。

### QWFRTY設計の背景事実：

#### 文字数頻度指標

(log圧縮済み、QMKのソース利用)は以下です。（大きいほどよく出てくるので、使いやすいところに置きたい文字）

* `s=26.2 d=26.2 f=16.9 g=9.4` `*.c` `*.h`
* `s=20.1 d=14.4 f=8.2  g=6.7` `*.md`

#### 交互打鍵・日本語入力

"f" は日本ではあまり使わない子音なので、交互打鍵を考えた際にも子音だが母音側にあっても"g"より悪影響が少ない。英語環境では、ともに中以下の頻度なので大差ない。

#### 右配置の移動文字間の優先順位

`s > d > g`

## 他のキー配列

* https://yushakobo.jp/blog/pluis9/2017/12/thinkkeylayout/

標準の「QWERTY配列」以外は、新しいキー配列提案が先に並んでいます。

以下は重要30キーにのみフォーカスし、Ortholinear系・ERGODOX系を意識した位置表示です。

### QWERTY配列
```
       LEFT HAND                 RIGHT HAND
│ Q │ W │ E │ R │ T │      │ Y │ U │ I │ O │ P │
│ A │ S │ D │ F │ G │      │ H │ J │ K │ L │ ; │
│ Z │ X │ C │ V │ B │      │ N │ M │ , │ . │ / │
```
* 0/30キーが移動(デフォルト)

### Eucalyn

* https://eucalyn.hatenadiary.jp/entry/saikyo-interface (2017-12-21 初期形)
```
│ / │ , │ . │ F │ Q │      │ M │ R │ D │ Y │ P │
│ A │ O │ E │ I │ U │      │ G │ T │ K │ S │ N │
│ Z │ X │ C │ V │ W │      │ B │ H │ J │ L │ ; │
```
* 23/30キーが移動

* https://eucalyn.hatenadiary.jp/entry/about-eucalyn-layout (2018-08-31 完成形)
```
│ Q │ W │ , │ . │ ; │      │ M │ R │ D │ Y │ P │
│ A │ O │ E │ I │ U │      │ G │ T │ K │ S │ N │
│ Z │ X │ C │ V │ F │      │ B │ H │ J │ L │ / │
```
* 20/30キーが移動

### Colemak Mod-DH

* https://colemakmods.github.io/mod-dh/
```
│ Q │ W │ F │ P │ B │      │ J │ L │ U │ Y │ ; │
│ A │ R │ S │ T │ G │      │ M │ N │ E │ I │ O │
│ Z │ X │ C │ D │ V │      │ K │ H │ , │ . │ / │
```
* 17/30キーが移動

### WORKMAN

* https://workmanlayout.org/
```
│ Q │ D │ R │ W │ B │      │ J │ F │ U │ P │ ; │
│ A │ S │ H │ T │ G │      │ Y │ N │ E │ O │ I │
│ Z │ X │ M │ C │ V │      │ K │ L │ , │ . │ / │
```
* 21/30キーが移動

### Colemak

* https://colemak.com/
```
│ Q │ W │ F │ P │ G │      │ J │ L │ U │ Y │ ; │
│ A │ R │ S │ T │ D │      │ H │ N │ E │ I │ O │
│ Z │ X │ C │ V │ B │      │ K │ M │ , │ . │ / │
```
* 19/30キーが移動

### Dvorak mod-slash

* https://en.wikipedia.org/wiki/Dvorak_keyboard_layout

```
│ / │ , │ . │ P │ Y │      │ F │ G │ C │ R │ L │
│ A │ O │ E │ U │ I │      │ D │ H │ T │ N │ S │
│ ; │ Q │ J │ K │ X │      │ B │ M │ W │ V │ Z │
```
* 28/30キーが移動

適用対象がOrtholinear配列のため「`'`」が「`/`」となっている。（「`'`」は真ん中のどのキー配列でも上記枠外の隙間に配置済み）

## 文字頻度

QMK の`quantum/`中や`docs/`中を統計して、スペースの数を１００としている。"`*`"はログ圧縮して大局観が分かるようになっています。

```
Cソースコード                  ドキュメンテーション中
" "  = 100.0 **********
"e"  = 61.9 *********          "e"  = 37.7 ********
"t"  = 41.0 ********           "t"  = 27.7 *******
"a"  = 32.2 ********           "a"  = 22.2 *******
"i"  = 38.3 ********           "i"  = 22.1 *******
"o"  = 31.4 *******            "o"  = 23.4 *******
"n"  = 30.7 *******            "n"  = 19.4 *******
"r"  = 30.3 *******            "r"  = 19.4 *******
"s"  = 26.2 *******            "s"  = 20.1 *******
"d"  = 26.2 *******            "d"  = 14.4 ******
"c"  = 23.7 *******            "c"  = 13.3 ******
"l"  = 18.2 *******            "l"  = 13.5 ******
"f"  = 16.9 ******             "f"  =  8.2 *****
"u"  = 15.4 ******             "u"  = 10.9 ******
"m"  = 14.3 ******             "m"  =  9.8 *****
"p"  = 13.9 ******             "p"  =  8.3 *****
"k"  = 10.6 ******             "k"  =  5.5 ****
"h"  = 10.3 ******             "h"  = 11.1 ******
"b"  =  9.5 *****              "b"  =  6.5 *****
"g"  =  9.4 *****              "g"  =  6.7 *****
"y"  =  9.3 *****              "y"  =  6.5 *****
"v"  =  5.9 *****              "v"  =  3.3 ****
"w"  =  5.7 *****              "w"  =  4.4 ****
"x"  =  5.5 ****               "x"  =  1.6 **
"q"  =  0.9 *                  "q"  =  1.0 **
"j"  =  0.5 *                  "j"  =  0.3 *
"z"  =  0.5 *                  "z"  =  0.2 *
````

ここで高頻度の子音文字「tnrsdcl」の非母音側への集中度と母音集中側の母音の数をみます：

|キー配列 | 頻出子音字集中| 母音集中| キー移動数 |
|---------|:----------------:|:----------:|:----:|
| QUERTY    |   5/7       |     3/5   |0 |
| **QUFRTY**  |   4/7     |     5/5   |11 |
| Colemak dh|   5/7       |     4/5   |17 |
| Colemak   |   5/7       |     4/5   |19 |
| Eucalyn   |   6/7       |     5/5   |20 |
| WORKMAN   |   5/7       |     4/5   |21 |
| DVRAK     |   7/7       |     5/5   |28 |

**QWFRTY**
はキー移動を避けたため、最頻出の「`T`」が母音側のままという問題が出ています。
でも`TH`などの子音同士の連続の交互打鍵は確保できていますので、捨てたものではありません。
とにかく変更が少なく、母音が集中するのがいい感じです。
（確かに`T`と`Y`の交換で改善しますが、キー移動数が増えるのと`TH`が隣接等のマイナスもあります。過ぎたるは及ばざるが如しです。）

ちなみにC言語のソースの場合、記号でスペース比較で約４％以上の頻度は以下だけでした。

```
" "  = 100.0 **********
"_"  = 35.9 ********
"("  = 10.5 ******
")"  = 10.5 ******
";"  =  7.0 *****
","  =  6.7 *****
"#"  =  6.2 *****
"*"  =  6.2 *****
"."  =  4.4 ****
"/"  =  6.4 *****
"0"  =  6.3 *****
"="  =  4.8 ****
"""  =  3.5 ****
```

## 余談

上記統計結果もあって、「`_` 」 はスプリット直交配置の真ん中に特別にシフト無しでアクセスできるようにしてます。
また"("と")"は定位置のFn片押しの","と"/"以外に、Fn両押しですが押しやすい真ん中にも配置しました。

さらに、スペースキーは、実質6つあります。スペース連打用が１つ、あとは shift, control, Alt, FnUp, FnDnとタップを使って兼用です。

日本語入力切り替えは、確定論的挙動としたいので`alt-`&#96;トグルではなく`shift-space` や`control-space`でローマ字かな入力と英字入力の間を往復してます。(これはGNOMEだけでなくWINDWS環境でも共通でできます。)
この変換関連でのスペース多用の際の使い勝手は実際のキーボードでは細かい配慮がされています。隣を叩いてもだいたいOKです。

最新の詳細状況は、[私のQMKソース](https://github.com/osamuaoki/qmk_firmware/blob/osamu1/keyboards/cgc56/keymaps/default/keymap.c)を見ないと分かりません。

![QWFRTY詳細](/img/QWFRTY.png)

PLANCK他のキーボードより幅が有り、両手間隔がとれ猫背にならずに使えます。また小指の使用を抑えたので指にやさしいと思います。

[cgc56 QWFRTY キーボードデータ 詳細版](http://www.keyboard-layout-editor.com/#/gists/bb66579d5945aafb78ffca0227cb87f0)


<!-- vim: se ai tw=79: -->


