---
title: GITの「`main`」への移行
date: 2021-01-27
categories:
  - programming
  - japanese
tags:
  - git
slug: git-master-main
---

２１世紀の世情の反映で、 [PC](https://en.wikipedia.org/wiki/Political_correctness)
の視点から、デフォールトのブランチ名は、「`master`」に代わり、新規のプロジェクトでは
「`main`」が使われていきます。

過去のプロジェクトでも同様にするべく、「`master`」から「`main`」へのデフォールト
ブランチ名を移行する手順を備忘録を兼ねたメモを作成します。

## GITHUBサーバーの変更

GithubのWeb interfaceで、Settings -> Branches -> Default branch から
「`master`」を「`main`」と変更します。

## ローカルのrepoの変更

### ローカルブランチ名の変更

次に、以下の手順でローカルのrepoのブランチ名の変更し状態を確認します。

```
$ git branch -a
* master
  remotes/origin/HEAD -> origin/master
  remotes/origin/master
$ git branch -m master main
$ git branch -a
* main
  remotes/origin/HEAD -> origin/master
  remotes/origin/master
$ git status -sb
## main...origin/master
```

### トラッキングの移行

上記だけでは、リモートのトラッキングがうまくできません。そこで追加の
関連設定をします。

```
$ git fetch origin
From github.com:<user_name>/<project_name>
 * [new branch]      main       -> origin/main
$ git branch -a
* main
  remotes/origin/HEAD -> origin/master
  remotes/origin/main
  remotes/origin/master
$ git status -sb
## main...origin/master
$ git branch -u origin/main main
Branch 'main' set up to track remote branch 'main' from 'origin'.
$ git branch -a
* main
  remotes/origin/HEAD -> origin/master
  remotes/origin/main
  remotes/origin/master
$ git status -sb
## main...origin/main
```

### 整合性の確保

上記で新ブランチ名で使えるのですが、`remotes/origin/master`が残っているのが
目障りです。綺麗に新ブランチ名に移行するには、これを消してHEADの整合性を確保
します。

```
$ git branch -r -D origin/master
Deleted remote-tracking branch origin/master (was ???????).
$ git symbolic-ref refs/remotes/origin/HEAD refs/remotes/origin/main

```

ここで、上記の最後の処理は、以下のコマンド実行時のWARNINGの解消をしてくれます。

```
$ git branch -a
warning: ignoring broken ref refs/remotes/origin/HEAD
...
```

綺麗に新ブランチ名に移行するのは結構大変です。

## 参考Cookbookサイト

* [github.comの状況](https://github.com/github/renaming)
* [総論としての背景](https://tools.ietf.org/id/draft-knodel-terminology-00.html)、


<!-- vim: se ai tw=79: -->
