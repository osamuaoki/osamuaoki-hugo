---
title: QMK (4) -- ホームポジションMT配列
date: 2022-03-15
categories:
  - iot
  - japanese
tags:
  - qmk
slug: home-mt
---

## 状況

QMKを使う[cgc56やcgg56というQMKを利用したキーボード](https://github.com/osamuaoki/cg56)等を使って、色々試して気づいたり考えたことを以下に記します。

* メンタルストレス無く、フィジカルストレスの小さい指の動きが少ないキーマップが欲しい。
  * 親指がカバーするのは、横に並ぶ２キーが望ましい (英語専用なら１つでも可能は可能。動きとしては３つまでは可能だが、PCBが大きくなる)
  * 人差し指は縦の動きで２列カバーする。
  * 他の指は縦１列の動き以外はしない。
  * 「QWERTY」は当分メインのキーマップのベース。
  * 「QWFRTY」はローマ字入力用オプションの検討中キーマップ。
* 高速打鍵性自体は私の目指す所では無い。
* キーのピッチをきっちり確保するにはNC工具での工作が不可欠。
  * NCとしてはPCBが安いし、PCBを注文する際に10cm角に収めると更に安い。
* 統計結果から、記号では「`_` 」へのアクセスには要配慮。
* 14" のノートパソコン(Thinkpad T14 Gen1)に無いキーの優先度は低いと割り切る。
  * CURSORキーは重要なので、アクセス性は重要で、片手での操作性も重要。
  * TENキーはそれほど使用上重要では無いが、組み込むなら片手での操作性に配慮重要。
  * QMKのMOUSEキーはそれほど便利では無いので、組み込む際のアクセス性は重要で無い。

QMKではタップとホールドで出力キーが違う設定できますが、タップの入力文字の連続入力がカチカチ連打だと大変な気がしていました。

実際には、一度タップ直後の再タップ時にホールドするとタップに対応する文字の長押しになるようで、OS側が連打処理してくれ使い勝手良好です。

あまり複雑なキー動作の多重化は混乱を招き使い勝手が悪くなるのですべきでは無いですが、この辺を上手に使えば悪くない感じです。

## キーマップ

最初にトライしたレイヤー移動とモード変更機能のすべてを親指のキーに任せるアプローチには無理がありました。

そこで30%キーボード系の[ferris](https://github.com/qmk/qmk_firmware/tree/master/keyboards/ferris)のキーマップをヒントにし、「基本的に使う部分」を、左`3x5_2`キーと右`3x5_2`キーと限定し、親指はレイヤー移動のみにしたキーマップを組むのがフィジカルストレス低減によさそうです。

```
 │***│ Q │ W │ E │ R │ T │***│***│ Y │ U │ I │ O │ P │***│
 │***│lsA│lcS│laD│lgF│raG│***│***│raH│lgJ│laK│lcL│ls;│***│
 │***│ Z │ X │ C │ V │ B │***│***│ N │ M │ , │ . │ / │***│
 │***│***│***│***│Es3│Sp1│***│***│Sp2│En4│***│***│***│***│
```

ここのポイントは、人差し指〜小指のホームポジションのA行のキーに関して、通常の文字キー入力とモードキー(LSFT, LCTL, LALT, LGUI, RALT)入力を、`MT()`機能を使い両方ができるようにしています。このおかげで、アクセスのよい自然なポジションでタイプできます。

* 人差し指内側1つ隣: RALT (AltGr)
* 人差し指: LGUI
* 中指: LALT
* 薬指: LCTL
* 小指: LSFT

これで端のキー（特に下の角のキー）を基本使わ無くてもよくなるので、[Alice配列](https://salicylic-acid3.hatenablog.com/entry/key-layout)にしなくとも、手首へのストレスが下げられています。

一番下の４つの親指キーは、`LT()`機能を使って、４つあるTEMPORARY LAYER選択操作に加え、１２までのよくアクセスする非アルファベットキーの入力ができるようにしています。

[Retro Shift](https://docs.qmk.fm/#/feature_auto_shift?id=retro-shift)を有効にしています。

Thumb（親指）キーで押している際に１時的に有効化する一時レイヤーは実質２つで、横3列の３０物理キーで９０のキーがカバーできます。`MT()`機能を上手につかえばThumbキーは２つでもレイヤー実現に充分です。ただ、押しやすさと、`LT()`に加え`MT()`まで使うのを避けるために、各レイヤーを左右別にして４レイヤーとして打ちやすくレスポンスよくしています。

* Thumbキーのホームポジションを押すと、ファンクションキー・記号・数字のレイヤー(FL1, FL2)です。
* Thumbキーの隣のポジションを押すと、横10個のキーでカバーしきれなかったキーボード端の記号と、固定レーヤー2~4への移動キーのレイヤー(FL3, FL4)です。
* Thumbキーを押している側は、ホームポジションのA行のキーはモードキーとなります。

上記１時レイヤー以外に、レイヤー移動後固定されるレイヤーが４つあり、カーソル・テンキー・マウスキー・キーボード自体の設定レイヤーとなります。

上記では分かり易い様に、cgc56上の「基本的に使う部分」以外のキーを省略しました。もちろんこれらも使えるようになっています。

* 従来のキーボード両端の小指で操作するキー類や最下行のキー類には、旧来のキーボードと同様の機能を与え、学習障壁を下げるようにします。(小指の操作は嫌ですので、慣れたらなるべく使いません。)
* 中心部のキー類には、狭いので一時レイヤーに押し込んだキーボード端の記号とか`F11`や`F12`、ダイナミックマクロ関連キー、カーソール関連キーのアクセスを改善するために重複配置します。

キーマップの詳細の最新の状況は、私の以下のQMKソースを参照:

* [cgc56:osamu](https://github.com/osamuaoki/qmk_firmware/blob/osamu1/keyboards/cgc56/keymaps/osamu/keymap.c)
* [cgg56:osamu](https://github.com/osamuaoki/qmk_firmware/blob/osamu1/keyboards/cgg56/keymaps/osamu/keymap.c)

これらは通常キーボードからの移行によく配慮されていてなかなか良い感じです。ただほとんど使わないキーがある一方で、特に片手マウスでのカーソール関連への少々アクセスが面倒でした。

そこで、当面実験的に左右のアルファベットの間隔を更に広げて開いたスペースにカーソールキーを持ってきてます。

* [cgc56:wide](https://github.com/osamuaoki/qmk_firmware/blob/osamu1/keyboards/cgc56/keymaps/wide/keymap.c)

[KLEで実際にこのcgc56キーボードのwide keymap](http://www.keyboard-layout-editor.com/#/gists/9d8227f51f5da1dcf325c8d2e4275bba)で使う覚えるべき２レイヤーをまとめました。

![cgc56:wide BL1, FL2FL/3 in QWFRTY)](/img/cgc56-wide.png)

上のキーマップがFn1~F4の何れも押さない場合、下のキーマップがFn1かF2のいずれかがが押された場合です。

ちなみに上記の既に作ったキーボードは大きめの40%ともいえる、4 x 14 ortholinearキーボードですが、キーマップのベースが30％系なので、それに相当する「基本的に使う部分」だけからなる片側`3x5_2`キー構成なら、ドーターボードも含めてすべてが片側10cm角に収まりそうです。

![片側３４キーのスプリットキーボードのイメージ](/img/split34.png)

## PCB参考情報

片側`3x5_2`キー構成のスプリットの小さな携帯タイプが面白そうなので、当分は取り組まないけどPCBを作る際に参考となる情報をまとめました。

* 類似設計例のPCB Data のソース
  * [Helix](https://github.com/MakotoKurauchi/helix) -- 5x7+2 ortholinear -- RGB-LED, LP or MX (ソケット対応)
  * [let's split v2](https://github.com/climbalima/let-s-Split-v2) -- 4x6 ortholinear -- MX (ドーターボード裏付け)
  * [SU120](https://github.com/e3w2q/su120-keyboard) -- Expandable keyboard -- RGB-LED, LP or MX （モジュラー）
  * [Corne keyboard and more](https://github.com/foostan/crkbd) -- 3x6 +2 column staggered (helix based) (ソケット対応)
  * [Lime](https://github.com/HellSingCoder/LimeKeyboard) -- 4x6 +6 column staggered (helix based) (ソケット対応), joystick, RE
  * [ENV-KB](https://github.com/Envious-Data/Env-KB) -- many JLCPCB examples　(ソケット対応例あり)
  * [Fifi](https://github.com/raychengy/fifi_split_keeb) -- 3x5+3 column staggered
  * [ferris](https://github.com/pierrechevalier83/ferris) -- 3x5+2 column staggered (on board MCU)
  * [Sweep](https://github.com/davidphilipbarr/Sweep) -- 3x5+2 column staggered
* 参考基礎情報源
  * [Blog: PCB techniques -- sofle-keyboard](https://josef-adamcik.cz/electronics/let-me-introduce-you-sofle-keyboard-split-keyboard-based-on-lily58.html)
  * [Keebfol.io PCBs](https://keebfolio.netlify.app/) まとめサイト、PCB dataへのリンクあり
  * [Keebio Amoeba and more PCBs](https://github.com/mtl/keyboard-pcbs)
  * [PCB design from kiibohd](https://github.com/kiibohd/pcb) -- input club
  * [Cad data: keyboard_parts.pretty](https://github.com/colemarkham/keyboard_parts.pretty)
  * [Kailh PCB socket info](https://www.kailhswitch.com/pcb-socket/)
  * [Gateron company](https://en.gateron.cn) -- real site with real dns
    * [Gateron switch](https://www.gateron.co/) -- sales trap site ??? with undisclosed dns reg

<!--

![4x14 ortholinear配列キーボード(cgc56 with DSA)](/img/qwfrty.jpg)
old [cgc56 with OEM key caps (top down)](/img/cgc56.jpg)
old [4x14 ortholinear配列キーボード(cgc56 with DSA)](/img/cgc56r1f.jpg)
new: [cgc56 with DSA key caps (top down)](/img/cgc56r1.jpg)
[cgc56 full](/img/cgc56-4.png)
[cgc56 キーボードデータ 全体](http://www.keyboard-layout-editor.com/#/gists/faf55be2e2240ece6e2a82f5aba8add2)
[キーボードデータ](http://www.keyboard-layout-editor.com/#/gists/faf55be2e2240ece6e2a82f5aba8add2)
![QWFRTY詳細](/img/QWFRTY.png)

-->

<!-- vim: se ai tw=150: -->


